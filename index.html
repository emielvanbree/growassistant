<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<link rel="icon" type="image/png" href="kweekmaatjelogo.png">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data:;">
<title>Grow Buddy</title>
<style>
/* ====== 🎨 PLAYFUL THEME 🎨 ====== */
:root {
  --bg-start: #89f7fe;
  --bg-end: #66a6ff;
  --card: rgba(255, 255, 255, 0.65);
  --menu-card-bg: rgba(255, 255, 255, 0.95);
  --card-border: rgba(255, 255, 255, 0.3);
  --text: #2c3e50;
  --primary: #38761D;
  --primary-text: #fff;
  --muted: #5a7b8c;
  --line: #cce7ff;
  --cta: #ff7e5f;
  --cta-hover: #feb47b;
  --cta-text: #ffffff;
  --danger: #e74c3c;
  --danger-hover: #c0392b;
  --radius: 24px;
  --font-family: 'Nunito', sans-serif;
  --shadow: 0 8px 24px rgba(102, 166, 255, 0.2);

  --seg-seed: #f7d794;
  --seg-veg: #77dd77;
  --seg-flow: #fdfd96;
  --seg-flush: #89cff0;
}

.dark {
  --bg-start: #232526;
  --bg-end: #414345;
  --card: rgba(40, 40, 40, 0.65);
  --menu-card-bg: rgba(30, 30, 30, 0.95);
  --card-border: rgba(255, 255, 255, 0.1);
  --text: #ecf0f1;
  --primary: #A9C439;
  --muted: #95a5a6;
  --line: #3a5368;
  --cta: #ff8a65;
  --cta-hover: #ffab91;
  --danger: #e74c3c;
  --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

/* ====== ✨ DYNAMIC & IMMERSIVE STYLES ✨ ====== */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes float {
  0% { transform: translateY(0px) rotate(-2deg); }
  50% { transform: translateY(-15px) rotate(2deg); }
  100% { transform: translateY(0px) rotate(-2deg); }
}

@keyframes popIn {
    0% { transform: scale(0.8); opacity: 0; }
    80% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
}

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
    100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
}


* { box-sizing: border-box; }

html { scroll-behavior: smooth; }

body {
  margin: 0;
  font-family: var(--font-family);
  background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
}

/* Background Animated Blobs for Fun! */
body::before, body::after {
  content: '';
  position: fixed;
  left: 50%;
  top: 50%;
  width: 120vmax;
  height: 120vmax;
  border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
  opacity: 0.15;
  z-index: -1;
  animation: float 18s infinite linear;
}
body::before {
  background: #ffffff;
  transform: translate(-60%, -60%);
}
body::after {
  background: var(--cta);
  transform: translate(-40%, -40%);
  animation-duration: 22s;
  animation-direction: reverse;
}

h1 {
  margin: 0;
  color: var(--text);
  font-size: 28px;
  font-weight: 800;
  display: flex;
  align-items: center;
  gap: 12px;
}
.app-logo {
  width: 48px;
  height: 48px;
  object-fit: contain;
  display: inline-block;
  animation: float 8s ease-in-out infinite;
  animation-delay: -2s;
}

.container { max-width: 1080px; margin: 0 auto; padding: 12px 16px; }

/* Header */
header {
  position: sticky;
  top: 0;
  z-index: 10;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: saturate(1.5) blur(12px);
  border-bottom: 1px solid var(--card-border);
}
.dark header { background: rgba(0,0,0,0.1); }
.header-content { display: flex; gap: 16px; align-items: center; }
.header-actions { display: flex; gap: 8px; align-items: center; margin-left: auto; position: relative; }

/* Menu */
#btnMenuToggle { display: flex; }
#menuContent {
  display: none; 
  position: absolute; 
  top: calc(100% + 12px); 
  right: 0;
  background: var(--menu-card-bg); 
  border: 1px solid var(--card-border);
  border-radius: 18px; 
  box-shadow: var(--shadow);
  z-index: 20; 
  padding: 16px; 
  flex-direction: column;
  align-items: flex-start; 
  gap: 14px; 
  width: 260px;
  backdrop-filter: blur(10px);
  animation: popIn 0.3s ease-out;
}
#menuContent.is-open { display: flex; }

/* Buttons & Inputs - Let's make them FUN! */
button, .btn {
  appearance: none;
  border: none;
  padding: 10px 20px;
  border-radius: 999px; /* Super rounded! */
  cursor: pointer;
  font-size: 15px;
  font-weight: 700;
  color: var(--text);
  background: rgba(255,255,255,0.7);
  transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}
button:hover, .btn:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 8px 15px rgba(0,0,0,0.1);
}
button:active, .btn:active {
  transform: translateY(0) scale(0.95);
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.dark button, .dark .btn { background: rgba(255,255,255,0.1); color: var(--text); }

.btn-icon {
  background: transparent;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}
.btn-icon:hover { background: rgba(255,255,255,0.2); }
.btn-icon .material-icons { color: var(--primary); font-size: 24px; }
.dark .btn-icon .material-icons { color: var(--primary); }

.tab { background: transparent; box-shadow: none; }
.tab.active {
  background: var(--card);
  color: var(--primary);
  font-weight: 800;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  transform: scale(1.05);
}
.dark .tab.active { background: rgba(255,255,255,0.2); color: var(--primary); }

.btn-primary {
  background: linear-gradient(45deg, var(--cta), var(--cta-hover));
  color: var(--cta-text) !important;
  font-weight: 800;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

input, textarea, select {
  border: 1px solid transparent;
  border-radius: 14px;
  padding: 8px 14px;
  color: var(--text);
  background: rgba(255,255,255,0.5);
  width: 100%;
  font-family: var(--font-family);
  font-size: 15px;
  transition: all 0.2s ease;
}
input:focus, textarea:focus, select:focus {
  outline: none;
  box-shadow: 0 0 0 3px var(--cta-hover);
  border-color: var(--cta);
  background: rgba(255,255,255,0.8);
}
.dark input, .dark textarea, .dark select {
  background: rgba(0,0,0,0.2);
  color: var(--text);
  border-color: rgba(255,255,255,0.1);
}
.dark input:focus, .dark textarea:focus, .dark select:focus {
    background: rgba(0,0,0,0.3);
}

/* Layout & Cards - Make them float! */
main.container { padding: 20px 16px 60px; }
.grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 30px;
  animation: fadeIn 0.5s ease-out both;
}
@media (min-width:700px){.grid{grid-template-columns:1fr 1fr}}

.card {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  overflow: hidden;
  backdrop-filter: blur(12px);
  transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
  transform-origin: center;
}

.card:hover {
  box-shadow: 0 12px 28px rgba(102, 166, 255, 0.3);
}
.dark .card:hover { box-shadow: 0 12px 32px rgba(0,0,0,0.4); }

.card.is-collapsed { height: auto; }
.card.is-collapsed .row-info, .card.is-collapsed .card-b, .card.is-collapsed .actions-bar {
  display: none;
}
.btn-collapse svg { transition:transform .3s ease; }
.card.is-collapsed .btn-collapse svg { transform:rotate(-180deg); }

.card-h { padding: 20px; display: flex; flex-direction: column; gap: 16px; align-items: flex-start; }
.row-name { display: flex; gap: 8px; width: 100%; align-items: center; }
.row-name input {
  flex: 1; border: none; outline: none;
  font-size: 20px; font-weight: 800; background: transparent;
  color: var(--text); min-width: 150px; padding: 4px;
}
.row-strain { display: flex; gap: 12px; align-items: center; width: 100%; }
.row-strain select { flex: 1; }

.row-info {
    display: flex; flex-wrap: wrap; gap: 10px 16px; align-items: center;
    font-size: 14px; color: var(--muted); width: 100%; justify-content: space-between;
}
.row-info input[type="date"] { width: auto; min-width: 135px; }
.row-info .action-buttons { display: flex; gap: 8px; flex-shrink: 0; }

.section-title { font-weight: 700; font-size: 18px; margin: 16px 0 8px; color: var(--text); }
.hint { font-size: 13px; color: var(--muted); }
.pill {
  font-size: 13px;
  background: rgba(255,255,255,0.4);
  border: 1px solid transparent;
  color: var(--text);
  padding: 4px 12px;
  border-radius: 999px;
  font-weight: 600;
}
.dark .pill { background: rgba(255,255,255,0.1); }
.tabs { display: flex; gap: 4px; background: rgba(0,0,0,0.05); border-radius: 999px; padding: 4px; margin-top: 8px; width: 100%;}
.dark .tabs { background: rgba(0,0,0,0.2); }
.tabs .tab {
    padding: 8px 10px;
    font-size: 13px;
    flex: 1;
    text-align: center;
    white-space: nowrap;
}
.card-b { border-top: 1px solid var(--line); padding: 20px; }

/* --- NEW: REMINDER TAB LAYOUT --- */
.reminder-grid {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 16px 10px;
  align-items: center;
}
.reminder-label {
  display: flex;
  align-items: center;
  gap: 6px;
  justify-self: start;
  font-weight: 600;
  color: var(--muted);
  text-align: left;
}
.dark .reminder-label {
  color: var(--primary);
}
.reminder-controls {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  justify-content: flex-end;
}
.reminder-controls input[type="number"] {
  width: 65px;
  text-align: center;
}

/* Event Log Styles */
.event-log-container { max-height: 400px; overflow-y: auto; }
.event-item { display: flex; gap: 12px; padding: 8px 4px; border-bottom: 1px solid var(--line); font-size: 14px; }
.event-item:last-child { border-bottom: none; }
.event-timestamp { font-size: 12px; color: var(--muted); white-space: nowrap; flex-shrink: 0; }
.event-text { color: var(--text); }

/* Empty State - Make it inviting! */
.empty {
  border: none;
  border-radius: var(--radius);
  padding: 40px;
  text-align: center;
  background: var(--card);
  box-shadow: var(--shadow);
  backdrop-filter: blur(12px);
  animation: popIn 0.5s ease-out 0.2s both;
}
.empty h2 {
  font-size: 36px;
  font-weight: 800;
  color: var(--text);
  margin: 0;
  line-height: 1.2;
}
.empty p { font-size: 20px; max-width: 450px; margin: 16px auto 0; color: var(--muted); }
.empty .benefit-list {
  list-style: none; padding: 0; margin: 32px 0; display: inline-flex;
  flex-direction: column; align-items: flex-start; gap: 16px; text-align: left;
}
.empty .benefit-list li { display: flex; align-items: center; gap: 12px; font-size: 18px; color: var(--text); }
.empty .benefit-list .material-icons { color: var(--primary); font-size: 28px; }
.empty .btn-primary { margin-top: 24px; padding: 16px 32px; font-size: 20px; }

/* Action Items - Make them pop! */
.actions-bar {
  width: 100%; display: flex; flex-direction: column; align-items: flex-start;
  gap: 10px; border-bottom: 1px dashed var(--line); padding-bottom: 12px; min-height: 40px;
}
.action-item {
  display: flex; align-items: center; justify-content: space-between;
  width: 100%; background: var(--card); color: var(--text); font-weight: 700;
  padding: 10px 16px; border-radius: 16px; cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05); gap: 8px;
  border-left: 5px solid;
  transition: all 0.2s ease;
}
.action-item:hover {
  transform: translateX(5px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
.action-item .left { display: flex; align-items: center; gap: 10px; }
.action-item .action-date { font-size: 12px; font-weight: 400; color: var(--muted); padding-left: 10px; }

.action-item.water { border-color: #89cff0; } /* Water Blue */
.action-item.feed { border-color: #77dd77; } /* Feed Green */
.action-item.flush { border-color: #fdfd96; } /* Flush Yellow */
.action-item.harvest {
  border-color: var(--cta);
  background: linear-gradient(45deg, var(--cta), var(--cta-hover));
  color: var(--cta-text);
  font-weight: 800;
}
.action-item.harvest .action-date { color: rgba(255,255,255,0.7); }

/* Progress Bar - More visual! */
.progress-wrapper { width: 100%; margin-top: 16px; padding-top: 12px; border-top: 1px dashed var(--line); }
.progress-date-labels { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); padding: 0 2px 6px; }
.progress-bar-container { position: relative; width: 100%; margin-bottom: 6px; }
.progress-bar { display: flex; height: 16px; border-radius: 8px; overflow: hidden; border: 1px solid var(--card-border); background: rgba(255,255,255,0.5); }
.progress-segment { height: 100%; }
.seg-seed{background:var(--seg-seed)}.seg-veg{background:var(--seg-veg)}.seg-flow{background:var(--seg-flow)}.seg-flush{background:var(--seg-flush)}

.progress-marker {
  position: absolute; top: -8px; width: 4px; height: 32px;
  background: var(--danger); border-radius: 2px;
  transform: translateX(-2px); z-index: 5;
  box-shadow: 0 0 8px var(--danger);
  animation: pulse 2s infinite;
}
.progress-marker-label {
  position: absolute; top: -30px; font-size: 11px; font-weight: bold;
  background: var(--danger); color: #fff; padding: 3px 6px;
  border-radius: 6px; white-space: nowrap; transform: translateX(-50%);
}

.progress-phase-labels-container { display: flex; font-size: 12px; padding: 0; color: var(--text); margin-top: 4px; font-weight: 600; }
.progress-phase-label { text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 0 4px; }


/* Modals - Softer feel */
.modal-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.5); display: none; align-items: center;
  justify-content: center; z-index: 1000; backdrop-filter: blur(8px);
  animation: fadeIn 0.3s ease;
}
.modal-content {
  background: var(--card); padding: 28px; border-radius: var(--radius);
  max-width: 640px; width: 90%; position: relative;
  box-shadow: var(--shadow); border: 1px solid var(--card-border);
  animation: popIn 0.4s ease-out;
}
.modal-close {
  position: absolute;
  top: 16px;
  right: 16px;
  background: transparent;
  border: none;
  font-size: 32px;
  line-height: 1;
  cursor: pointer;
  color: var(--muted);
  padding: 0;
  width: auto;
  height: auto;
  transition: all 0.2s ease;
}

.modal-close:hover {
  color: var(--text);
  transform: scale(1.1);
}

/* Misc */
.danger { background: var(--danger); color: var(--cta-text) !important; }
.danger:hover { background: var(--danger-hover); }

/* ===== Gamification Styles ===== */
.grower-status{display:none;align-items:center;gap:8px;font-size:14px;font-weight:600;color:var(--text);background:var(--card);padding:8px 14px;border-radius:999px;margin-left:16px}
@media (min-width:769px){.grower-status{display:flex}}
.achievements-list{list-style:none;padding:0;margin-top:20px;max-height:40vh;overflow-y:auto; display: grid; grid-template-columns: 1fr; gap: 8px;}
@media (min-width: 600px) { .achievements-list { grid-template-columns: 1fr 1fr; } }
.achievement-item{display:flex;align-items:center;gap:16px;padding:12px;border-radius:16px;transition: all 0.2s ease; border: 1px solid transparent;}
.achievement-item.locked{opacity:.6;background: rgba(0,0,0,0.05);}
.achievement-item.unlocked{background: linear-gradient(135deg, #77dd77, #a8e6cf); border-color: rgba(255,255,255,0.5);}
.achievement-item .icon{font-size:36px;color:var(--primary)}
.achievement-item.unlocked .icon { color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
.achievement-item .details h4{margin:0 0 4px;color:var(--text)}
.achievement-item.unlocked .details h4 { color: white; font-weight: 700; }
.achievement-item .details p{margin:0;font-size:14px;color:var(--muted)}
.achievement-item.unlocked .details p { color: rgba(255,255,255,0.85); }
#toast{position:fixed;bottom:-100px;left:50%;transform:translateX(-50%);background: linear-gradient(45deg, var(--cta), var(--cta-hover));color:var(--cta-text);padding:16px 28px;border-radius:18px;box-shadow:0 6px 20px rgba(0,0,0,.2);z-index:2000;transition:all .5s cubic-bezier(0.175, 0.885, 0.32, 1.275);font-weight:700;border:none; text-align: center;}
#toast.show{bottom:20px; transform: translateX(-50%) scale(1); opacity: 1;}
#toast:not(.show) { transform: translateX(-50%) scale(0.8); opacity: 0; }

/* Unchanged Utility Styles */
.uploader{display:flex;flex-wrap:wrap;gap:8px;padding:10px;background:rgba(0,0,0,0.05);border:1px solid var(--line);border-radius:14px}
figure{margin:0;border:1px solid var(--line);border-radius:14px;overflow:hidden;background:#fff}
figure img{display:block;width:100%;height:auto;max-height:300px;object-fit:cover}
figcaption{padding:10px;display:flex;justify-content:space-between;gap:10px;font-size:14px;flex-wrap:wrap}
.muted{color:var(--muted)}
.archived{opacity:.6}
.btn-affiliate{background:var(--cta);border-color:var(--cta);color:#fff!important;padding:6px 10px;border-radius:12px;font-size:12px;font-weight:700;text-decoration:none;display:inline-flex;align-items:center;gap:6px;white-space:nowrap}
.btn-affiliate:hover{background:var(--cta-hover);border-color:var(--cta-hover)}
.sticky-footer-container {
position: sticky; bottom: -20px; margin: 20px -20px -20px -20px;
padding: 14px; background: var(--card); border-top: 1px solid var(--line);
box-shadow: 0 -4px 12px rgba(0,0,0,0.05); z-index: 5;
}
.dark .sticky-footer-container { box-shadow: 0 -4px 12px rgba(0,0,0,0.2); }
.whatsapp-fab {
position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px;
background-color: #25D366; color: #FFF; border-radius: 50%; display: flex;
align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
z-index: 100; transition: transform 0.2s ease-in-out; text-decoration: none;
}
.whatsapp-fab:hover { transform: scale(1.1) rotate(10deg); }
.whatsapp-fab svg { width: 32px; height: 32px; fill: #fff; }
.toggle-container{display:flex;align-items:center;gap:8px;font-size:14px;justify-content:space-between;width:100%;}
.toggle-switch{position:relative;display:inline-block;width:44px;height:24px;flex-shrink:0;}
.toggle-switch input{opacity:0;width:0;height:0}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#ccc;transition:.3s;border-radius:24px}
.slider:before{position:absolute;content:"";height:16px;width:16px;left:4px;bottom:4px;background:#fff;transition:.3s;border-radius:50%}
.toggle-switch input:checked + .slider{background:var(--cta)}
.toggle-switch input:checked + .slider:before{transform:translateX(20px)}
.dark .slider{background:#555}
.dark .toggle-switch input:checked + .slider{background:var(--cta-hover)}
footer { padding: 40px 16px 20px; text-align: center; }
.footer-notice { font-size: 11px; color: var(--muted); max-width: 600px; margin: 0 auto; line-height: 1.5; }
#legal-content { max-height: 70vh; overflow-y: auto; font-size: 14px; color: var(--text); line-height: 1.6; }
#legal-content h3 { font-size: 18px; margin: 24px 0 10px; color: var(--text); }
#legal-content h4 { font-size: 15px; margin: 16px 0 8px; color: var(--text); }
#legal-content p, #legal-content li { color: var(--muted); }
#legal-content .disclaimer { font-style: italic; background: rgba(0,0,0,0.05); padding: 10px; border-radius: 8px; }
.dark #legal-content p, .dark #legal-content li { color: var(--text); opacity: 0.8; }
.btn-whatsapp{display:inline-flex;align-items:center;gap:10px;background-color:#25D366;color:#fff!important;padding:10px 16px;border-radius:16px;text-decoration:none;font-weight:bold;border:none;cursor:pointer}
.btn-whatsapp:hover{background-color:#1DA851}
.btn-whatsapp svg{width:20px;height:20px;fill:#fff}
</style>
</head>
<body>

<header>
<div class="container header-content">
<h1 id="appTitle">
<img class="app-logo" src="kweekmaatjelogo.png" alt="logo"/>
<span id="appTitleText">Grow Buddy</span>
</h1>
<div id="growerStatusDisplay" class="grower-status"></div>
<div class="header-actions">
<button id="btnAdd" class="btn-primary" data-i18n="newPlant">+ New Plant</button>
<button id="btnProfileDesktop" class="btn-icon" title="Stoner Status" aria-label="Stoner Status">
<span class="material-icons">emoji_events</span>
</button>
<div id="menuContent">
<button id="btnHeaderShare" class="btn" style="width: 100%; justify-content: flex-start; gap: 8px;">
<span class="material-icons">share</span><span data-i18n="shareTitle">Share</span>
</button>
<hr style="width:100%; border:0; border-top: 1px solid var(--line); margin: 4px 0;">
<select id="langSelect" style="border-radius:16px;font-size:14px;padding:8px 10px;width:100%">
<option value="nl">Nederlands</option><option value="en">English</option><option value="de">Deutsch</option><option value="fr">Français</option><option value="es">Español</option>
</select>
<div class="toggle-container">
<label id="darkModeLabel">Dark Mode</label>
<label class="toggle-switch">
<input type="checkbox" id="darkModeToggle"/><span class="slider"></span>
</label>
</div>
<div class="toggle-container">
<label data-i18n="showArchived">Show completed cycles</label>
<label class="toggle-switch">
<input type="checkbox" id="chkArchived"/>
<span class="slider"></span>
</label>
</div>
<hr style="width:100%; border:0; border-top: 1px solid var(--line); margin: 4px 0;">
<button id="btnHelp" class="btn" style="width: 100%; justify-content: flex-start; gap: 8px;">
<svg fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>
<span data-i18n="helpTitle">Help & Information</span>
</button>
<button id="btnReset" class="danger" data-i18n="resetData">Reset data</button>
</div>
<button id="btnMenuToggle" class="btn-icon" aria-label="Open menu">
<svg fill="currentColor" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</button>
</div>
</div>
</header>
<main class="container">
<div id="empty" class="empty" style="display:none">
<h2 data-i18n="emptyTitle">Your Personal Grow Coach</h2>
<p data-i18n="emptyText">Stop guessing. Always the right action at the right time.</p>
<ul class="benefit-list">
<li><span class="material-icons">rocket_launch</span><span data-i18n="emptyBenefit1">Start your grow in 30 seconds</span></li>
<li><span class="material-icons">lock</span><span data-i18n="emptyBenefit2">100% local & private on your device</span></li>
<li><span class="material-icons">insights</span><span data-i18n="emptyBenefit3">Reminders & visual photo log</span></li>
</ul>
<button id="btnAdd2" class="btn-primary" data-i18n="newPlant">+ New Plant</button>
<div id="nudge" style="display:none; margin-top: 24px; font-size: 14px; color: var(--muted);" data-i18n="exitNudge">
Start your first plant — no account needed, everything is local.
</div>
</div>
<div id="grid" class="grid"></div>
<section id="archivedSection" style="display:none;margin-top:24px">
<div class="section-title" data-i18n="archivedTitle">Completed Cycles</div>
<div id="archivedGrid" class="grid archived"></div>
</section>
</main>
<footer>
    <div class="container">
        <p class="footer-notice" data-i18n="footerNotice"></p>
    </div>
</footer>

<div id="helpModal" class="modal-overlay" style="display:none">
<div class="modal-content">
<button class="modal-close" aria-label="Close">&times;</button>
<h2 id="helpTitle" data-i18n="helpTitle">Help & Information</h2>
<div id="legal-content"></div>
</div>
</div>
<div id="shareModal" class="modal-overlay" style="display:none">
<div class="modal-content">
<button class="modal-close" aria-label="Close">&times;</button>
<h2 data-i18n="shareTitle">Share Report</h2>
<p id="shareExplain" data-i18n="shareExplain">Share the status report and celebrate the success with your friends.</p>
<div class="report-actions" style="display: flex; gap: 10px; margin-top: 16px;">
<button id="btnShareNow" class="btn btn-primary" data-i18n="shareNow">Share</button>
<button class="btn" data-close-modal data-i18n="close">Close</button>
</div>
<p class="hint" id="shareFallbackMsg" style="display:none; margin-top: 16px;" data-i18n="shareFallback">Sharing not supported; we'll download the JPG report instead.</p>
</div>
</div>
<div id="harvestShareModal" class="modal-overlay" style="display:none">
    <div class="modal-content">
        <button class="modal-close" aria-label="Close">&times;</button>
        <h2 data-i18n="shareTitle">Share Report</h2>
        <p id="harvestShareText" style="margin-top: 8px;"></p>
        <div class="report-actions" style="display: flex; gap: 10px; margin-top: 16px;">
            <button id="btnHarvestShareNow" class="btn btn-primary" data-i18n="shareNow">Share</button>
            <button class="btn" data-close-modal data-i18n="close">Close</button>
        </div>
    </div>
</div>
<div id="harvestReviewModal" class="modal-overlay" style="display:none">
    <div class="modal-content">
        <h2 data-i18n="harvestReviewTitle">Harvest Review</h2>
        <p data-i18n="harvestReviewText">Your cycle is complete! Add some notes about your harvest and the overall process for future reference.</p>
        <textarea id="harvestReviewTextarea" style="width:100%;min-height:150px;" data-i18n-placeholder="harvestReviewPlaceholder"></textarea>
        <div class="report-actions" style="display: flex; gap: 10px; margin-top: 16px;">
            <button id="btnSaveHarvestReview" class="btn btn-primary" data-i18n="saveNotes">Save Notes</button>
            <button id="btnSkipHarvestReview" class="btn" data-i18n="skip">Skip</button>
        </div>
    </div>
</div>
<div id="helpModal2" class="modal-overlay" style="display:none">
<div class="modal-content">
<button class="modal-close" aria-label="Close">&times;</button>
<h2 id="infoTitle">Info</h2>
<div id="infoBody"></div>
</div>
</div>
<div id="stonerStatusModal" class="modal-overlay" style="display:none">
<div class="modal-content">
<button class="modal-close" aria-label="Close">&times;</button>
<h2 data-i18n="stonerStatusTitle">Your Stoner Status</h2>
<div id="stonerStatusBody"></div>
</div>
</div>
<div id="toast"></div>
<a href="https://wa.me/31655793636?text=Hi!%20I%20have%20a%20question%20about%20Grow%20Buddy." class="whatsapp-fab" target="_blank" rel="noopener noreferrer" aria-label="Q&A via WhatsApp">
<svg viewBox="0 0 24 24"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91c0 1.79.46 3.48 1.34 4.94L2.05 22l5.25-1.42c1.4.78 2.96 1.21 4.59 1.21h.01c5.46 0 9.91-4.45 9.91-9.91S17.5 2 12.04 2m.01 1.66c4.56 0 8.26 3.7 8.26 8.26 0 4.56-3.7 8.26-8.26 8.26h-.01c-1.47 0-2.89-.39-4.14-1.1L4.65 19.35l1.19-3.23c-.79-1.25-1.22-2.7-1.22-4.21 0-4.56 3.7-8.26 8.26-8.26M9.27 7.93c-.14-.23-.29-.24-.42-.24-.12 0-.27 0-.42.01-.15.01-.37.21-.57.42-.2.2-.72.7-.72 1.73s.74 2.01.84 2.15c.1.15 1.45 2.29 3.53 3.12.55.22.99.36 1.34.46.59.18 1.13.15 1.55.09.48.06 1.4-.68 1.6-1.36.2-.68.2-1.25.14-1.36-.06-.11-.21-.18-.42-.32-.21-.15-1.25-.62-1.45-.69-.2-.07-.35-.11-.5.11-.15.22-.55.69-.68.83-.12.15-.24.16-.44.1-.2-.05-1.02-.37-1.94-1.2-.72-.65-1.2-1.45-1.34-1.7-.14-.25-.02-.38.09-.5.1-.11.22-.27.34-.41.11-.13.15-.22.22-.37.07-.15.04-.28-.02-.38s-.5-.6-.68-.82z"/></svg>
</a>
<script>
/* ===== i18n ===== */
const legalDisclaimerNL = `<p class="disclaimer">De originele en juridisch bindende versie van dit document is in het Engels. Deze vertaling wordt alleen voor het gemak aangeboden en er kunnen geen rechten aan worden ontleend.</p>`;
const legalDisclaimerDE = `<p class="disclaimer">Die ursprüngliche und rechtsverbindliche Version dieses Dokuments ist in englischer Sprache. Diese Übersetzung wird nur zur Vereinfachung zur Verfügung gestellt und es können daraus keine Rechte abgeleitet werden.</p>`;
const legalDisclaimerFR = `<p class="disclaimer">La version originale et juridiquement contraignante de ce document est in anglais. Cette traduction est fournie à titre de commodité uniquement et aucun droit ne peut en être dérivé.</p>`;
const legalDisclaimerES = `<p class="disclaimer">La versión original y legalmente vinculante de este documento está en inglés. Esta traducción se proporciona únicamente para su comodidad y no se pueden derivar derechos de ella.</p>`;
const legalTextEN = `<h3>Terms of Use</h3><h4>Effective date: 01-10-2025</h4><h4>1) Overview</h4><p>Kweekmaatje is a lightweight, client-side web app by NightOwl Logics (“we,” “us”). By accessing or using the app or site (the “Service”), you agree to these Terms.</p><h4>2) Eligibility & local laws</h4><p>You are responsible for complying with the laws in your jurisdiction. We do not encourage illegal activity. If cultivation or related activities are unlawful where you are, do not use the Service for those purposes.</p><h4>3) License & ownership</h4><p>We grant you a limited, revocable, non-exclusive, non-transferable license to use the Service for personal, non-commercial purposes. All content and code are owned by NightOwl Logics or its licensors and are protected by IP laws. We reserve all rights not expressly granted.</p><h4>4) User content</h4><p>Photos, notes, and data you add stay on your device’s local storage unless you explicitly export/share them. You are solely responsible for your content and for obtaining any necessary permissions.</p><h4>5) Privacy</h4><p>The app is 100% frontend; we do not run a backend for your data. See our Privacy Policy for details, including third-party services (e.g., fonts, outbound links).</p><h4>6) Acceptable use</h4><p>You agree not to:</p><ul><li>Copy, redistribute, or commercially exploit the Service or its assets without written permission.</li><li>Reverse-engineer, decompile, or scrape the Service or its data.</li><li>Interfere with the Service’s operation or bypass security measures.</li><li>Upload unlawful, infringing, or harmful content.</li></ul><p>See the Copyright & Acceptable Use clause below for more detail.</p><h4>7) Third-party links & affiliates</h4><p>The Service may link to third-party sites (e.g., WhatsApp, seed vendors, or informational articles). We are not responsible for their content, policies, or practices. Affiliate links may generate a commission.</p><h4>8) No professional/harvest guarantees</h4><p>Information is provided for general guidance only; outcomes vary. You use the Service at your own risk.</p><h4>9) Disclaimers</h4><p>THE SERVICE IS PROVIDED “AS IS” AND “AS AVAILABLE” WITHOUT WARRANTIES OF ANY KIND, EXPRESS OR IMPLIED.</p><h4>10) Limitation of liability</h4><p>To the fullest extent permitted by law, NightOwl Logics and its affiliates will not be liable for indirect, incidental, special, consequential, or exemplary damages, or loss of data or profits.</p><h4>11) Indemnity</h4><p>You agree to indemnify and hold NightOwl Logics harmless from claims arising out of your use of the Service or violation of these Terms.</p><h4>12) Changes & termination</h4><p>We may modify the Service or these Terms at any time. If you continue using the Service after changes take effect, you accept the updated Terms. We may suspend or terminate access for any breach.</p><h4>13) Governing law</h4><p>These Terms are governed by the laws of the Netherlands (conflict-of-law principles excluded). Courts of Amsterdam shall have exclusive jurisdiction. If you prefer a different jurisdiction, contact us before using the Service.</p><hr><h3>Privacy Policy</h3><h4>Effective date: 10-10-2025</h4><p>NightOwl Logics (“we,” “us”) operates Kweekmaatje (the “Service”).</p><h4>1) Data we process (short answer: local only)</h4><p>App data you add (plant names, dates, notes, photos) is stored only on your device in your browser’s local storage (and in-memory while you use the app). We do not collect or store your personal data on our servers, and we do not receive your photos, notes, or timeline unless you choose to export/share them via your device.</p><h4>2) Device permissions</h4><p>Photos/Camera/File access: Used solely to let you add images into your local timeline. Files stay local unless you export/share. Share/report feature: Creates a report image client-side; if you use your device’s share sheet, your OS handles the transfer.</p><h4>3) Local storage & cookies</h4><p>We use localStorage to save your plants, notes, settings (e.g., language, dark mode). No tracking cookies are set by us.</p><h4>4) Third-party services & outbound links</h4><p>Google Fonts (fonts.googleapis.com / fonts.gstatic.com) may process your IP and user agent to deliver fonts. See Google’s privacy policy for details. Outbound/affiliate links (e.g., seed vendors) and WhatsApp contact links take you to third-party sites/services, which have their own privacy practices and may use cookies or tracking. We do not control or operate these services.</p><h4>5) Analytics & logging</h4><p>We do not run server-side analytics or retain server logs of your usage.</p><h4>6) Children</h4><p>The Service is intended for adults where cultivation-related content is legal. If you are under the legal age in your jurisdiction, do not use the Service.</p><h4>7) Your rights</h4><p>Because we don’t collect personal data server-side, typical access/erasure requests to us don’t apply. You can delete your data directly via the in-app “Reset data” button or by clearing your browser storage/cache.</p><h4>8) Security</h4><p>Your data stays on your device. Protect your device/browser with passcodes and backups. Exported files you share are your responsibility.</p><h4>9) Changes</h4><p>We may update this policy. Material changes will be reflected by updating the “Effective date.”</p><hr><h3>Copyright & Acceptable Use</h3><h4>1) Ownership</h4><p>All code, design, text, graphics, logos (including “Kweekmaatje” and the Kweekmaatje logo), and other materials in the Service are owned by NightOwl Logics or its licensors and are protected by copyright, trademark, and other laws.</p><h4>2) Your limited license</h4><p>We grant you a personal, non-commercial, non-transferable, revocable license to access and use the Service as intended.</p><h4>3) Prohibited uses</h4><p>Without our prior written permission, you may not:</p><ul><li>Copy, reproduce, modify, adapt, translate, create derivative works from, distribute, or publicly display any part of the Service or its assets.</li><li>Reverse-engineer, decompile, disassemble, or otherwise attempt to derive source code (except where such restrictions are prohibited by law).</li><li>Data-mine, scrape, or use automated tools to extract data, content, or code.</li><li>Remove or alter copyright, trademark, or other proprietary notices.</li><li>Use the Service for illegal, infringing, harmful, or deceptive purposes.</li></ul><h4>4) Fair use & interoperability</h4><p>Nothing in this clause limits rights you may have under mandatory law (e.g., fair use, reverse-engineering strictly for interoperability where permitted).</p><hr><h3>Contact</h3><a id="whatsappBtnLegal" href="https://wa.me/31655793636?text=Contact%20NightOwl%20Logics" target="_blank" rel="noopener noreferrer" class="btn-whatsapp"><svg viewBox="0 0 24 24"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91c0 1.79.46 3.48 1.34 4.94L2.05 22l5.25-1.42c1.4.78 2.96 1.21 4.59 1.21h.01c5.46 0 9.91-4.45 9.91-9.91S17.5 2 12.04 2m.01 1.66c4.56 0 8.26 3.7 8.26 8.26 0 4.56-3.7 8.26-8.26 8.26h-.01c-1.47 0-2.89-.39-4.14-1.1L4.65 19.35l1.19-3.23c-.79-1.25-1.22-2.7-1.22-4.21 0-4.56 3.7-8.26 8.26-8.26M9.27 7.93c-.14-.23-.29-.24-.42-.24-.12 0-.27 0-.42.01-.15.01-.37.21-.57.42-.2.2-.72.7-.72 1.73s.74 2.01.84 2.15c.1.15 1.45 2.29 3.53 3.12.55.22.99.36 1.34.46.59.18 1.13.15 1.55.09.48.06 1.4-.68 1.6-1.36.2-.68.2-1.25.14-1.36-.06-.11-.21-.18-.42-.32-.21-.15-1.25-.62-1.45-.69-.2-.07-.35-.11-.5.11-.15.22-.55.69-.68.83-.12.15-.24.16-.44.1-.2-.05-1.02-.37-1.94-1.2-.72-.65-1.2-1.45-1.34-1.7-.14-.25-.02-.38.09-.5.1-.11.22-.27.34-.41.11-.13.15-.22.22-.37.07-.15.04-.28-.02-.38s-.5-.6-.68-.82z"/></svg><span data-i18n="contactOnWhatsapp">Contact NightOwl Logics</span></a>`;

const TRANSLATIONS={
    nl:{
        appName:"Kweekmaatje",newPlant:"+ Nieuwe plant",showArchived:"Toon voltooide cycli",emptyTitle:"Je eigen kweekcoach",emptyText:"Nooit meer gokken. Altijd de juiste actie op het juiste moment.",emptyBenefit1:"Start je kweek in 30 seconden",emptyBenefit2:"100% lokaal & privé op je apparaat",emptyBenefit3:"Herinneringen & visueel fotologboek",exitNudge:"Start je eerste plant — geen account nodig, alles lokaal.",harvestSharePrompt:"Een van je planten is bijna oogstrijp. Deel het rapport en vier het met je vrienden!",
        helpTitle:"Info & Voorwaarden", footerNotice: "© 2025 NightOwl Logics. Alle rechten voorbehouden. “Kweekmaatje” en alle gerelateerde namen, logo's en middelen zijn handelsmerken van NightOwl Logics.", contactOnWhatsapp: "Contact NightOwl Logics", termsAndPrivacyBody: legalDisclaimerNL + legalTextEN,
        archivedTitle:"Voltooide Cycli",plant:"Plant",archivedCycle:"Cyclus Voltooien",unarchive:"Herstellen",delete:"Cyclus Verwijderen",planted:"Geplant:",age:"Leeftijd:",weeks:"wk",days:"d",timeline:"Fotodagboek",reminders:"Herinneringen",notes:"Notities",snoozeReminders:"Herinneringen snoozen",date:"Datum:",noteOptional:"Opmerking (optioneel)",uploadPhoto:"Upload foto",noPhotos:"Nog geen foto's – voeg je eerste Week 0 foto toe hierboven.",remove:"Verwijder",water:"💧 Water",feed:"🥦 Voeding",startFlush:"💦 START FLUSH",harvest:"🪴 OOGSTEN",week:"Week",every:"Elke",daysPlural:"dagen",startInWeek:"Start in week",frequency:"Frequentie: elke",flushStartWeek:"Flush starten in week",targetHarvestWeek:"🪴 Doel oogstweek",strainGuideline:"Soort Richtlijn:",adjustNote:"Pas frequentie aan op potmaat, substraat en klimaat.",notesPlaceholder:"Notities over water, EC/PPM, pH, training, etc.",alertPhoto:"Kies eerst een foto.",alertDelete:"Verwijderen? Dit kan niet ongedaan worden gemaakt (alle foto's gaan mee).",alertMax:"Maximaal 12 plantjes ondersteund.",alertImport:"Kan bestand niet lezen:",darkMode:"Dark Mode",seedling:"Kiemfase",vegetative:"Groeifase",flowering:"Bloeifase",flush:"Spoelfase",today:"Vandaag",buyNow:"Nu kopen",resetData:"Reset data",confirmReset:"Weet je zeker dat je alle gegevens wilt verwijderen? Dit kan niet ongedaan worden gemaakt.",growthReportTitle:"Groeirapport",shareTitle:"Delen",shareExplain:"Deel het statusrapport en vier het succes met je vrienden.",shareNow:"Delen",close:"Sluiten",shareFallback:"Delen wordt niet ondersteund; we downloaden het JPG-rapport in plaats daarvan.",stonerStatusTitle:"Je Stoner Status",completedCycles:"Voltooide Cycli",achievements:"Badges",completedHarvestsLabel:"Oogsten Geknald",toastNewAchievement:"🏆 Badge behaald!",
        harvestReviewTitle: "Oogst Beoordeling", harvestReviewText: "Je cyclus is voltooid! Voeg notities toe over je oogst en het proces voor toekomstig gebruik.", harvestReviewPlaceholder: "Bijv., Kwaliteit oogst: uitstekend, zeer compacte toppen. Geur: fruitig. Kweeknotities: Reageerde goed op LST in week 3. Volgende keer minder voeding in de bloei gebruiken ivm lichte overvoeding...", saveNotes: "Notities Opslaan", skip: "Overslaan", eventLog: "Logboek",
        logPlantCreated: "Plant aangemaakt.", logDateChanged: "Startdatum gewijzigd naar", logScheduleChanged: "Schema bijgewerkt:", logSnoozeEnabled: "Herinneringen op snooze gezet.", logSnoozeDisabled: "Snooze voor herinneringen uitgezet.", logCycleCompleted: "Cyclus voltooid.", logCycleRestored: "Cyclus hersteld uit archief.", logPhotoAdded: "Foto toegevoegd aan dagboek.", logStrainChanged: "Soort gewijzigd naar", logNoteUpdated: "Notities bijgewerkt.",
        recommendedForSeedling: "Aanbevolen voor Kiemfase", recommendedForVegetative: "Aanbevolen voor Groeifase", recommendedForFlowering: "Aanbevolen voor Bloeifase", recommendedForFlush: "Aanbevolen voor Spoelen & Oogst", heatMat: "Warmtemat", growthNutrients: "Groeivoeding", calMag: "Cal-Mag", fabricPots: "Stoffen Potten", ecMeter: "EC Meter", phMeter: "pH Meter", clipFan: "Clip Fan", plantTies: "Plantenbinders", carbonFilter: "Koolstoffilter", bloomNutrients: "Bloeivoeding", pkBooster: "PK Booster", scrogNet: "Scrog Net", flushHarvestGuide: "Droog/Cure Gids", flushingAgent: "Spoelmiddel", trimmingScissors: "Knipschaar", dryingRack: "Droogrek", curingJars: "Curing Potten", miniHygrometers: "Mini Hygrometers", humidityPacks: "Vochtigheidsregelaars"
    },
    en:{
        appName:"Grow Buddy",newPlant:"+ New Plant",showArchived:"Show Completed Cycles",emptyTitle:"Your Personal Grow Coach",emptyText:"Stop guessing. Always the right action at the right time.",emptyBenefit1:"Start your grow in 30 seconds",emptyBenefit2:"100% local & private on your device",emptyBenefit3:"Reminders & visual photo log",exitNudge:"Start your first plant — no account needed, everything is local.",harvestSharePrompt:"One of your plants is almost ready for harvest. Share the report and celebrate with your friends!",
        helpTitle:"Info & Terms", footerNotice: "© 2025 NightOwl Logics. All rights reserved. “Kweekmaatje” and all related names, logos, and assets are trademarks of NightOwl Logics.", contactOnWhatsapp: "Contact NightOwl Logics", termsAndPrivacyBody: legalTextEN,
        archivedTitle:"Completed Cycles",plant:"Plant",archivedCycle:"Complete Cycle",unarchive:"Restore",delete:"Delete Cycle",planted:"Planted:",age:"Age:",weeks:"wks",days:"d",timeline:"Photo diary",reminders:"Reminders",notes:"Notes",snoozeReminders:"Snooze reminders",date:"Date:",noteOptional:"Note (optional)",uploadPhoto:"Upload Photo",noPhotos:"No photos yet – add your first Week 0 photo above.",remove:"Remove",water:"💧 Water",feed:"🥦 Feed",startFlush:"💦 START FLUSH",harvest:"🪴 HARVEST",week:"Week",every:"Every",daysPlural:"days",startInWeek:"Start in Week",frequency:"Frequency: every",flushStartWeek:"Start Flush in Week",targetHarvestWeek:"🪴 Target Harvest Week",strainGuideline:"Strain Guideline:",adjustNote:"Adjust frequency based on pot size, substrate, and climate.",notesPlaceholder:"Notes on watering, EC/PPM, pH, training, etc.",alertPhoto:"Please select a photo first.",alertDelete:"Delete? This cannot be undone (all photos will be deleted).",alertMax:"Maximum of 12 plants supported.",alertImport:"Cannot read file:",darkMode:"Dark Mode",seedling:"Seedling",vegetative:"Vegetative",flowering:"Flowering",flush:"Flush",today:"Today",buyNow:"Buy now",resetData:"Reset data",confirmReset:"Are you sure you want to delete all data? This cannot be undone.",growthReportTitle:"Growth Report",shareTitle:"Share",shareExplain:"Share the status report and celebrate the progress with your friends.",shareNow:"Share",close:"Close",shareFallback:"Sharing not supported; downloading JPG instead.",stonerStatusTitle:"Your Stoner Status",completedCycles:"Completed Cycles",achievements:"Badges",completedHarvestsLabel:"Harvests Nailed",toastNewAchievement:"🏆 Badge Unlocked!",
        harvestReviewTitle: "Harvest Review", harvestReviewText: "Your cycle is complete! Add some notes about your harvest and the overall process for future reference.", harvestReviewPlaceholder: "E.g., Harvest quality: excellent, very dense buds. Smell: fruity. Grow notes: Responded well to LST in week 3. Next time, use less nutrients during flowering as I noticed some nute burn...", saveNotes: "Save Notes", skip: "Skip", eventLog: "Event Log",
        logPlantCreated: "Plant created.", logDateChanged: "Start date changed to", logScheduleChanged: "Schedule updated:", logSnoozeEnabled: "Reminders snoozed.", logSnoozeDisabled: "Reminders unsnoozed.", logCycleCompleted: "Cycle completed.", logCycleRestored: "Cycle restored from archive.", logPhotoAdded: "Photo added to diary.", logStrainChanged: "Strain changed to", logNoteUpdated: "Notes updated.",
        recommendedForSeedling: "Recommended for Seedling Stage", recommendedForVegetative: "Recommended for Vegetative Stage", recommendedForFlowering: "Recommended for Flowering Stage", recommendedForFlush: "Recommended for Flush & Harvest", heatMat: "Heat Mat", growthNutrients: "Growth Nutrients", calMag: "Cal-Mag", fabricPots: "Fabric Pots", ecMeter: "EC Meter", phMeter: "pH Meter", clipFan: "Clip Fan", plantTies: "Plant Ties", carbonFilter: "Carbon Filter", bloomNutrients: "Bloom Nutrients", pkBooster: "PK Booster", scrogNet: "Scrog Net", flushHarvestGuide: "Drying/Curing Guide", flushingAgent: "Flushing Agent", trimmingScissors: "Trimming Scissors", dryingRack: "Drying Rack", curingJars: "Curing Jars", miniHygrometers: "Mini Hygrometers", humidityPacks: "Humidity Packs"
    },
    de:{
        appName:"Kraut Kumpel",newPlant:"+ Neue Pflanze",showArchived:"Abgeschlossene Zyklen anzeigen",emptyTitle:"Dein persönlicher Grow-Coach",emptyText:"Schluss mit Raten. Immer die richtige Aktion zur richtigen Zeit.",emptyBenefit1:"Starte deinen Grow in 30 Sekunden",emptyBenefit2:"100% lokal & privat auf deinem Gerät",emptyBenefit3:"Erinnerungen & visuelles Fotoprotokoll",exitNudge:"Starte deine erste Pflanze – kein Konto nötig, alles lokal.",harvestSharePrompt:"Eine deiner Pflanzen ist fast erntereif. Teile den Bericht und feiere mit deinen Freunden!",
        helpTitle:"Info & Bedingungen", footerNotice: "© 2025 NightOwl Logics. Alle Rechte vorbehalten. „Kweekmaatje“ und alle zugehörigen Namen, Logos und Assets sind Marken von NightOwl Logics.", contactOnWhatsapp: "Kontakt NightOwl Logics", termsAndPrivacyBody: legalDisclaimerDE + legalTextEN,
        archivedTitle:"Abgeschlossene Zyklen",plant:"Pflanze",archivedCycle:"Zyklus abschließen",unarchive:"Wiederherstellen",delete:"Zyklus Löschen",planted:"Gepflanzt:",age:"Alter:",weeks:"Wo",days:"T",timeline:"Fototagebuch",reminders:"Erinnerungen",notes:"Notizen",snoozeReminders:"Erinnerungen stummschalten",date:"Datum:",noteOptional:"Notiz (optional)",uploadPhoto:"Foto hochladen",noPhotos:"Noch keine Fotos – fügen Sie Ihr erstes Foto der Woche 0 oben hinzu.",remove:"Entfernen",water:"💧 Wasser",feed:"🥦 Nährstoffe",startFlush:"💦 SPÜLUNG STARTEN",harvest:"🪴 ERNTEN",week:"Woche",every:"Alle",daysPlural:"Tage",startInWeek:"Start in Woche",frequency:"Frequenz: alle",flushStartWeek:"Spülung starten in Woche",targetHarvestWeek:"🪴 Ziel Erntewoche",strainGuideline:"Sortenrichtlinie:",adjustNote:"Passen Sie die Häufigkeit an Topfgröße, Substrat und Klima an.",notesPlaceholder:"Notizen zu Bewässerung, EC/PPM, pH, Training, etc.",alertPhoto:"Bitte wählen Sie zuerst ein Foto aus.",alertDelete:"Löschen? Dies kann nicht rückgängig gemacht werden (alle Fotos werden gelöscht).",alertMax:"Maximal 12 Pflanzen werden unterstützt.",alertImport:"Datei kann nicht gelesen werden:",darkMode:"Dunkelmodus",seedling:"Keimling",vegetative:"Vegetativ",flowering:"Blüte",flush:"Spülen",today:"Heute",buyNow:"Jetzt kaufen",resetData:"Daten zurücksetzen",confirmReset:"Alle Daten löschen? Dies kann nicht rückgängig gemacht werden.",growthReportTitle:"Wachstumsbericht",shareTitle:"Teilen",shareExplain:"Teile den Statusbericht und feiere die Erfolge mit deinen Freunden.",shareNow:"Teilen",close:"Schließen",shareFallback:"Teilen nicht unterstützt; JPG-Download.",stonerStatusTitle:"Dein Stoner-Status",completedCycles:"Abgeschlossene Zyklen",achievements:"Abzeichen",completedHarvestsLabel:"Ernten gemeistert",toastNewAchievement:"🏆 Abzeichen freigeschaltet!",
        harvestReviewTitle: "Erntebewertung", harvestReviewText: "Dein Zyklus ist abgeschlossen! Füge Notizen über deine Ernte und den gesamten Prozess als Referenz hinzu.", harvestReviewPlaceholder: "Z.B., Erntequalität: ausgezeichnet, sehr dichte Buds. Geruch: fruchtig. Anbau-Notizen: Reagierte gut auf LST in Woche 3. Nächstes Mal weniger Dünger während der Blüte verwenden, da ich leichte Nährstoffverbrennungen bemerkt habe...", saveNotes: "Notizen speichern", skip: "Überspringen", eventLog: "Ereignisprotokoll",
        logPlantCreated: "Pflanze erstellt.", logDateChanged: "Startdatum geändert zu", logScheduleChanged: "Zeitplan aktualisiert:", logSnoozeEnabled: "Erinnerungen stummgeschaltet.", logSnoozeDisabled: "Stummschaltung aufgehoben.", logCycleCompleted: "Zyklus abgeschlossen.", logCycleRestored: "Zyklus wiederhergestellt.", logPhotoAdded: "Foto zum Tagebuch hinzugefügt.", logStrainChanged: "Sorte geändert zu", logNoteUpdated: "Notizen aktualisiert.",
        recommendedForSeedling: "Empfohlen für Keimlingsphase", recommendedForVegetative: "Empfohlen für Wachstumsphase", recommendedForFlowering: "Empfohlen für Blütephase", recommendedForFlush: "Empfohlen für Spülung & Ernte", heatMat: "Heizmatte", growthNutrients: "Wachstumsdünger", calMag: "Cal-Mag", fabricPots: "Stofftöpfe", ecMeter: "EC-Messgerät", phMeter: "pH-Messgerät", clipFan: "Clip-Ventilator", plantTies: "Pflanzenbinder", carbonFilter: "Aktivkohlefilter", bloomNutrients: "Blütedünger", pkBooster: "PK Booster", scrogNet: "Scrog-Netz", flushHarvestGuide: "Trocknungs-Anleitung", flushingAgent: "Spülmittel", trimmingScissors: "Ernteschere", dryingRack: "Trockennetz", curingJars: "Fermentiergläser", miniHygrometers: "Mini-Hygrometer", humidityPacks: "Feuchtigkeitspacks"
    },
    fr:{
        appName:"Copain de Culture",newPlant:"+ Nouvelle Plante",showArchived:"Afficher les Cycles Terminés",emptyTitle:"Votre Coach de Culture Personnel",emptyText:"Fini de deviner. Toujours la bonne action au bon moment.",emptyBenefit1:"Commencez votre culture en 30 secondes",emptyBenefit2:"100% local et privé sur votre appareil",emptyBenefit3:"Rappels et journal photo visuel",exitNudge:"Commencez votre première plante — aucun compte requis, tout est local.",harvestSharePrompt:"Une de vos plantes est presque prête pour la récolte. Partagez le rapport et célébrez avec vos amis!",
        helpTitle:"Infos & Conditions", footerNotice: "© 2025 NightOwl Logics. Alle rechten voorbehouden. « Kweekmaatje » et tous les noms, logos et actifs associés sont des marques commerciales de NightOwl Logics.", contactOnWhatsapp: "Contacter NightOwl Logics", termsAndPrivacyBody: legalDisclaimerFR + legalTextEN,
        archivedTitle:"Cycles Terminés",plant:"Plante",archivedCycle:"Terminer le Cycle",unarchive:"Restaurer",delete:"Supprimer Cycle",planted:"Planté(e):",age:"Âge:",weeks:"sem",days:"j",timeline:"Journal photo",reminders:"Rappels",notes:"Notes",snoozeReminders:"Mettre les rappels en sourdine",date:"Date:",noteOptional:"Note (optionnel)",uploadPhoto:"Télécharger photo",noPhotos:"Aucune photo pour l'instant – ajoutez votre première photo de la Semaine 0 ci-dessus.",remove:"Retirer",water:"💧 Eau",feed:"🥦 Engrais",startFlush:"💦 DÉBUT RINÇAGE",harvest:"🪴 RÉCOLTER",week:"Semaine",every:"Tous les",daysPlural:"jours",startInWeek:"Début Semaine",frequency:"Fréquence : tous les",flushStartWeek:"Début Rinçage Semaine",targetHarvestWeek:"🪴 Semaine de Récolte Cible",strainGuideline:"Ligne directrice de la souche:",adjustNote:"Ajustez la fréquence en fonction de la taille du pot, du substrat et du climat.",notesPlaceholder:"Notes sur l'arrosage, EC/PPM, pH, entraînement, etc.",alertPhoto:"Veuillez d'abord sélectionner une photo.",alertDelete:"Supprimer ? Ceci est irréversible (toutes les photos seront supprimées).",alertMax:"Maximum de 12 plantes prises en charge.",alertImport:"Impossible de lire le fichier :",darkMode:"Mode Sombre",seedling:"Germination",vegetative:"Végétative",flowering:"Floraison",flush:"Rinçage",today:"Aujourd'hui",buyNow:"Acheter",resetData:"Réinitialiser",confirmReset:"Supprimer toutes les données ? Ceci est irréversible.",growthReportTitle:"Rapport de croissance",shareTitle:"Partager",shareExplain:"Partage le rapport d’état et célèbre tes réussites avec tes amis.",shareNow:"Partager",close:"Fermer",shareFallback:"Le partage n'est pas pris en charge ; téléchargement du JPG à la place.",stonerStatusTitle:"Ton Statut de Stoner",completedCycles:"Cycles Terminés",achievements:"Badges",completedHarvestsLabel:"Récoltes Réussies",toastNewAchievement:"🏆 Badge débloqué !",
        harvestReviewTitle: "Évaluation de la Récolte", harvestReviewText: "Votre cycle est terminé ! Ajoutez des notes sur votre récolte et le processus global pour référence future.", harvestReviewPlaceholder: "Ex: Qualité de la récolte : excellente, têtes très denses. Odeur : fruitée. Notes de culture : A bien réagi au LST en semaine 3. La prochaine fois, utiliser moins de nutriments pendant la floraison car j'ai remarqué une légère brûlure...", saveNotes: "Enregistrer les Notes", skip: "Passer", eventLog: "Journal d'événements",
        logPlantCreated: "Plante créée.", logDateChanged: "Date de début changée en", logScheduleChanged: "Calendrier mis à jour:", logSnoozeEnabled: "Rappels en sourdine.", logSnoozeDisabled: "Rappels réactivés.", logCycleCompleted: "Cycle terminé.", logCycleRestored: "Cycle restauré.", logPhotoAdded: "Photo ajoutée au journal.", logStrainChanged: "Variété changée en", logNoteUpdated: "Notes mises à jour.",
        recommendedForSeedling: "Recommandé pour la Germination", recommendedForVegetative: "Recommandé pour la Croissance", recommendedForFlowering: "Recommandé pour la Floraison", recommendedForFlush: "Recommandé pour le Rinçage & Récolte", heatMat: "Tapis Chauffant", growthNutrients: "Nutriments de Croissance", calMag: "Cal-Mag", fabricPots: "Pots en Tissu", ecMeter: "Testeur EC", phMeter: "Testeur pH", clipFan: "Ventilateur à Pince", plantTies: "Attaches pour Plantes", carbonFilter: "Filtre à Charbon", bloomNutrients: "Nutriments de Floraison", pkBooster: "PK Booster", scrogNet: "Filet Scrog", flushHarvestGuide: "Guide Séchage/Curing", flushingAgent: "Agent de Rinçage", trimmingScissors: "Ciseaux de Taille", dryingRack: "Filet de Séchage", curingJars: "Bocaux de Curing", miniHygrometers: "Mini Hygromètres", humidityPacks: "Sachets d'Humidité"
    },
    es:{
        appName:"Compa de Cultivo",newPlant:"+ Nueva Planta",showArchived:"Mostrar Ciclos Completados",emptyTitle:"Tu Coach de Cultivo Personal",emptyText:"Deja de adivinar. Siempre la acción correcta en het momento adecuado.",emptyBenefit1:"Comienza tu cultivo en 30 segundos",emptyBenefit2:"100% local y privado en tu dispositivo",emptyBenefit3:"Recordatorios y registro fotográfico visual",exitNudge:"Comienza tu primera planta — no se necesita cuenta, todo es local.",harvestSharePrompt:"Una de tus plantas está casi lista para la cosecha. ¡Comparte el informe y celebra con tus amigos!",
        helpTitle:"Info & Términos", footerNotice: "© 2025 NightOwl Logics. Todos los derechos reservados. “Kweekmaatje” y todos los nombres, logotipos y activos relacionados son marcas comerciales de NightOwl Logics.", contactOnWhatsapp: "Contactar NightOwl Logics", termsAndPrivacyBody: legalDisclaimerES + legalTextEN,
        archivedTitle:"Ciclos Completados",plant:"Planta",archivedCycle:"Completar Ciclo",unarchive:"Restaurar",delete:"Eliminar Ciclo",planted:"Plantada:",age:"Edad:",weeks:"sem",days:"d",timeline:"Diario de fotos",reminders:"Recordatorios",notes:"Notas",snoozeReminders:"Silenciar recordatorios",date:"Fecha:",noteOptional:"Nota (opcional)",uploadPhoto:"Subir foto",noPhotos:"Aún no hay fotos – añade tu primera foto de la Semana 0 arriba.",remove:"Quitar",water:"💧 Agua",feed:"🥦 Nutrientes",startFlush:"💦 INICIAR LAVADO",harvest:"🪴 COSECHAR",week:"Semana",every:"Cada",daysPlural:"días",startInWeek:"Iniciar Semana",frequency:"Frecuencia: cada",flushStartWeek:"Iniciar Lavado Semana",targetHarvestWeek:"🪴 Semana de Cosecha Objetivo",strainGuideline:"Pauta de la Cepa:",adjustNote:"Ajusta la frecuencia según el tamaño de la maceta, el sustrato y el clima.",notesPlaceholder:"Notas sobre riego, EC/PPM, pH, entrenamiento, etc.",alertPhoto:"Por favor, selecciona una foto primero.",alertDelete:"¿Eliminar? Esto no se puede deshacer (se eliminarán todas las fotos).",alertMax:"Máximo de 12 plantas admitidas.",alertImport:"No se puede leer el archivo:",darkMode:"Modo Oscuro",seedling:"Plántula",vegetative:"Vegetativa",flowering:"Floración",flush:"Lavado",today:"Hoy",buyNow:"Comprar ahora",resetData:"Restablecer datos",confirmReset:"¿Eliminar todos los datos? Esto no se puede deshacer.",growthReportTitle:"Informe de crecimiento",shareTitle:"Compartir",shareExplain:"Comparte el informe de estado y celebra los logros con tus amis.",shareNow:"Compartir",close:"Cerrar",shareFallback:"Compartir no disponible; descargaremos el JPG.",stonerStatusTitle:"Tu Estatus de Stoner",completedCycles:"Ciclos Completados",achievements:"Insignias",completedHarvestsLabel:"Cosechas Logradas",toastNewAchievement:"🏆 ¡Insignia desbloqueada!",
        harvestReviewTitle: "Evaluación de Cosecha", harvestReviewText: "¡Tu ciclo está completo! Añade algunas notas sobre tu cosecha y el proceso general para referencia futura.", harvestReviewPlaceholder: "Ej: Calidad de la cosecha: excelente, cogollos muy densos. Olor: afrutado. Notas de cultivo: Respondió bien al LST en la semana 3. La próxima vez, usar menos nutrientes durante la floración ya que noté algo de quemadura...", saveNotes: "Guardar Notas", skip: "Omitir", eventLog: "Registro de Eventos",
        logPlantCreated: "Planta creada.", logDateChanged: "Fecha de inicio cambiada a", logScheduleChanged: "Horario actualizado:", logSnoozeEnabled: "Recordatorios silenciados.", logSnoozeDisabled: "Recordatorios reactivados.", logCycleCompleted: "Ciclo completado.", logCycleRestored: "Ciclo restaurado.", logPhotoAdded: "Foto añadida al diario.", logStrainChanged: "Cepa cambiada a", logNoteUpdated: "Notas actualizadas.",
        recommendedForSeedling: "Recomendado para Plántula", recommendedForVegetative: "Recomendado para Crecimiento", recommendedForFlowering: "Recomendado para Floración", recommendedForFlush: "Recomendado para Lavado y Cosecha", heatMat: "Manta Térmica", growthNutrients: "Nutrientes de Crecimiento", calMag: "Cal-Mag", fabricPots: "Macetas de Tela", ecMeter: "Medidor de EC", phMeter: "Medidor de pH", clipFan: "Ventilador de Clip", plantTies: "Ataduras para Plantas", carbonFilter: "Filtro de Carbón", bloomNutrients: "Nutrientes de Floración", pkBooster: "PK Booster", scrogNet: "Red Scrog", flushHarvestGuide: "Guía de Secado/Curado", flushingAgent: "Agente de Lavado", trimmingScissors: "Tijeras de Podar", dryingRack: "Malla de Secado", curingJars: "Botes de Curado", miniHygrometers: "Mini Higrómetros", humidityPacks: "Bolsas de Humedad"
    }
};
/* ==== Reminder copy (per language & phase) ==== */
const REMINDER_COPY={nl:{feed:{seedling:"<p><b>Voeding:</b> Nog geen voeding. Potgrond bevat genoeg; extra voeding kan wortels verbranden.</p>",vegetative:"<p><b>Voeding (groei):</b> Focus op stikstof (N). Begin licht en bouw langzaam op.</p>",flowering:"<p><b>Voeding (bloei):</b> Meer fosfor (P) en kalium (K), minder stikstof (N). Let op overvoeding.</p>",flush:"<p><b>Voeding:</b> Tijdens spoelen geen voeding meer gebruiken.</p>"},water:{seedling:"<p><b>Water:</b> Heel weinig; 100–250 ml. Alleen wanneer bovenlaag droog is.</p>",vegetative:"<p><b>Water:</b> Matig tot veel. Geef tot lichte drainage.</p>",flowering:"<p><b>Water:</b> Hoog verbruik; 1.5–3 L per beurt (afhankelijk van potmaat).</p>",flush:"<p><b>Water:</b> Alleen water om zouten uit te spoelen.</p>"},flush:"<p><b>Spoelen:</b> 1–2 weken voor oogst alleen water voor betere smaak.</p>",harvest:"<p><b>Oogst:</b> Check trichomen; droog en cure voor kwaliteit.</p>"},
en:{feed:{seedling:"<p><b>Feeding:</b> None yet. Medium has enough; extra nutrients can burn roots.</p>",vegetative:"<p><b>Feeding (veg):</b> Emphasize nitrogen (N). Start light and increase gradually.</p>",flowering:"<p><b>Feeding (flower):</b> More phosphorus (P) & potassium (K), less N. Avoid overfeeding.</p>",flush:"<p><b>Feeding:</b> No nutrients during flush.</p>"},water:{seedling:"<p><b>Water:</b> Very little; 100–250 ml. Only when top layer is dry.</p>",vegetative:"<p><b>Water:</b> Moderate to high; water to slight runoff.</p>",flowering:"<p><b>Water:</b> Highest demand; often 1.5–3 L per watering.</p>",flush:"<p><b>Water:</b> Plain water to wash out salts.</p>"},flush:"<p><b>Flush:</b> 1–2 weeks pre-harvest with plain water.</p>",harvest:"<p><b>Harvest:</b> Check trichomes; dry & cure for best results.</p>"},
de:{feed:{seedling:"<p><b>Düngen:</b> Noch nicht. Substrat enthält genug; Zusatz kann Wurzeln verbrennen.</p>",vegetative:"<p><b>Düngen (Wuchs):</b> Fokus auf Stickstoff (N). Langsam steigern.</p>",flowering:"<p><b>Düngen (Blüte):</b> Mehr Phosphor (P) & Kalium (K), minder N.</p>",flush:"<p><b>Düngen:</b> Während des Spülens keine Nährstoffe.</p>"},water:{seedling:"<p><b>Wasser:</b> Sehr weinig; 100–250 ml. Nur bei trockener Oberfläche.</p>",vegetative:"<p><b>Wasser:</b> Mittel bis viel; bis leichte Drainage.</p>",flowering:"<p><b>Wasser:</b> Höchster Bedarf; oft 1.5–3 L.</p>",flush:"<p><b>Wasser:</b> Nur Wasser zum Ausspülen.</p>"},flush:"<p><b>Spülen:</b> 1–2 Wochen vor der Ernte nur Wasser.</p>",harvest:"<p><b>Ernte:</b> Trichome prüfen; trocknen & curen.</p>"},
fr:{feed:{seedling:"<p><b>Engrais :</b> Pas encore. Le substrat suffit; excès peut brûler les racines.</p>",vegetative:"<p><b>Engrais (croissance) :</b> Accent sur l’azote (N). Augmenter progressivement.</p>",flowering:"<p><b>Engrais (floraison) :</b> Plus de phosphore (P) et potassium (K), moins de N.</p>",flush:"<p><b>Engrais :</b> Aucun pendant le rinçage.</p>"},water:{seedling:"<p><b>Eau :</b> Très peu; 100–250 ml. Seulement si le dessus est sec.</p>",vegetative:"<p><b>Eau :</b> Modérée à forte; jusqu’à léger ruissellement.</p>",flowering:"<p><b>Eau :</b> Demande maximale; 1,5–3 L.</p>",flush:"<p><b>Eau :</b> Eau claire pour rincer les sels.</p>"},flush:"<p><b>Rinçage :</b> 1–2 semaines avant récolte, eau claire.</p>",harvest:"<p><b>Récolte :</b> Vérifier les trichomes; séchage & affinage.</p>"},
es:{feed:{seedling:"<p><b>Nutrientes:</b> Aún no. El sustrato tiene suficiente; el exceso quema raíces.</p>",vegetative:"<p><b>Nutrientes (crecimiento):</b> Énfasis en nitrógeno (N). Aumenta poco a poco.</p>",flowering:"<p><b>Nutrientes (floración):</b> Más fósforo (P) y potasio (K), menos N.</p>",flush:"<p><b>Nutrientes:</b> Ninguno durante el lavado.</p>"},water:{seedling:"<p><b>Agua:</b> Muy poca; 100–250 ml. Solo si la superficie está seca.</p>",vegetative:"<p><b>Agua:</b> Moderada a alta; hasta ligero drenaje.</p>",flowering:"<p><b>Agua:</b> Demanda máxima; 1.5–3 L.</p>",flush:"<p><b>Agua:</b> Solo agua para eliminar sales.</p>"},flush:"<p><b>Lavado:</b> 1–2 semanas antes de la cosecha con agua sola.</p>",harvest:"<p><b>Cosecha:</b> Revisa tricomas; secado y curado.</p>"} };
const REPORT_INTRO={nl:"Kijk eens hoe goed mijn plantjes onderweg zijn! 🌱💚",en:"Look how well my plants are doing! 🌱💚",de:"Schau mal, wie gut meine Pflanzen unterwegs sind! 🌱💚",fr:"Regardez comme mes plantes se portent bien ! 🌱💚",es:"¡Miren qué bien van mis plantas! 🌱💚",};
/* ==== Gamification Data ==== */
const BADGES = {
    'HYDRO_HERO': { 
        title: { nl: 'Hydro Hero', en: 'Hydro Hero', de: 'Hydro-Held', fr: 'Hydro Héros', es: 'Héroe del Riego' }, 
        description: { nl: '10x water-actie op tijd afgevinkt.', en: '10 water actions checked on time.', de: '10x Gieß-Aktion pünktlich erledigt.', fr: '10 arrosages cochés à temps.', es: '10 riegos marcados a tiempo.' }
    },
    'FEED_FREAK': { 
        title: { nl: 'Feed Freak', en: 'Feed Freak', de: 'Nährstoff-Freak', fr: 'Accro à l\'Engrais', es: 'Fanático del Nutriente' },
        description: { nl: '6x voeding-acties op rij volgens schema.', en: '6 feeding actions in a row on schedule.', de: '6x Dünge-Aktionen in Folge nach Plan.', fr: '6 nutriments consécutifs selon le calendrier.', es: '6 alimentaciones seguidas según lo previsto.' }
    },
    'ZEN_FLUSHER': {
        title: { nl: 'Zen Flusher', en: 'Zen Flusher', de: 'Zen-Spüler', fr: 'Rinceur Zen', es: 'Lavado Zen' },
        description: { nl: 'Flush exact in de geplande week gestart.', en: 'Started the flush exactly in the planned week.', de: 'Spülung exakt in der geplanten Woche gestartet.', fr: 'Rinçage démarré exactement la semaine prévue.', es: 'Lavado iniciado exactamente en la semana planificada.' }
    },
    'TIME_LORD': {
        title: { nl: 'Time Lord', en: 'Time Lord', de: 'Herr der Zeit', fr: 'Maître du Temps', es: 'Señor del Tiempo' },
        description: { nl: '3 cycli voltooid op de geplande oogstdatum.', en: '3 cycles completed on the target harvest date.', de: '3 Zyklen am geplanten Erntedatum abgeschlossen.', fr: '3 cycles terminés à la date de récolte prévue.', es: '3 ciclos completados en la fecha de cosecha objetivo.' }
    },
    'SHUTTER_BUD': {
        title: { nl: 'Shutter Bud', en: 'Shutter Bud', de: 'Blenden-Knospe', fr: 'Bourgeon Photographe', es: 'Amigo Fotógrafo' },
        description: { nl: '4 foto’s toegevoegd in één cyclus.', en: 'Added 4 photos in a single cycle.', de: '4 Fotos in einem Zyklus hinzugefügt.', fr: '4 photos ajoutées en un seul cycle.', es: '4 fotos añadidas en un solo ciclo.' }
    },
    'WEEK_BY_WEEK': {
        title: { nl: 'Week by Week', en: 'Week by Week', de: 'Woche für Woche', fr: 'Semaine par Semaine', es: 'Semana a Semana' },
        description: { nl: 'Minimaal 1 foto in elke week van een cyclus.', en: 'At least 1 photo in every week of a cycle.', de: 'Mind. 1 Foto in jeder Woche eines Zyklus.', fr: 'Au moins 1 photo chaque semaine d\'un cycle.', es: 'Al menos 1 foto en cada semana de un ciclo.' }
    },
    'FIELD_NOTES': {
        title: { nl: 'Field Notes', en: 'Field Notes', de: 'Feldnotizen', fr: 'Notes de Terrain', es: 'Notas de Campo' },
        description: { nl: '4 aparte notities opgeslagen in één cyclus.', en: 'Saved 4 separate notes in a single cycle.', de: '4 separate Notizen in einem Zyklus gespeichert.', fr: '4 notes distinctes enregistrées en un cycle.', es: '4 notas separadas guardadas en un solo ciclo.' }
    },
    'TERP_TOURIST': {
        title: { nl: 'Terp Tourist', en: 'Terp Tourist', de: 'Terpen-Tourist', fr: 'Touriste Terpénique', es: 'Turista de Terpenos' },
        description: { nl: '5 verschillende strains succesvol afgerond.', en: 'Successfully completed 5 different strains.', de: '5 verschiedene Sorten erfolgreich abgeschlossen.', fr: '5 variétés différentes terminées avec succès.', es: '5 cepas diferentes completadas con éxito.' }
    },
    'CATALOG_CONQUEROR': {
        title: { nl: 'Catalog Conqueror', en: 'Catalog Conqueror', de: 'Katalog-Eroberer', fr: 'Conquérant du Catalogue', es: 'Conquistador del Catálogo' },
        description: { nl: '10 verschillende strains afgerond.', en: 'Completed 10 different strains.', de: '10 verschiedene Sorten abgeschlossen.', fr: '10 variétés différentes terminées.', es: '10 cepas diferentes completadas.' }
    },
    'SEASONAL_SAMPLER': {
        title: { nl: 'Seasonal Sampler', en: 'Seasonal Sampler', de: 'Saison-Probierer', fr: 'Dégustateur Saisonnier', es: 'Catador Estacional' },
        description: { nl: '4 cycli gestart in verschillende kwartalen.', en: 'Started 4 cycles in different seasons.', de: '4 Zyklen in verschiedenen Quartalen gestartet.', fr: '4 cycles commencés dans des trimestres différents.', es: '4 ciclos iniciados en diferentes trimestres.' }
    },
    'DRY_HANDS': {
        title: { nl: 'Dry Hands', en: 'Dry Hands', de: 'Ruhige Hände', fr: 'Mains Stables', es: 'Manos Quietas' },
        description: { nl: 'Eén cyclus voltooid zonder de startdatum aan te passen.', en: 'Completed one cycle without changing the start date.', de: 'Ein Zyklus ohne Änderung des Startdatums abgeschlossen.', fr: 'Un cycle terminé sans changer la date de début.', es: 'Un ciclo completado sin cambiar la fecha de inicio.' }
    },
    'HYPE_MACHINE': {
        title: { nl: 'Hype Machine', en: 'Hype Machine', de: 'Hype-Maschine', fr: 'Machine à Hype', es: 'Máquina de Hype' },
        description: { nl: 'Je kweekrapport 1 keer gedeeld.', en: 'Shared your grow report once.', de: 'Deinen Grow-Report 1 Mal geteilt.', fr: 'Ton rapport de culture partagé 1 fois.', es: 'Tu informe de cultivo compartido 1 vez.' }
    },
    'COMMUNITY_CLOUD': {
        title: { nl: 'Community Cloud', en: 'Community Cloud', de: 'Community-Cloud', fr: 'Nuage Communautaire', es: 'Nube Comunitaria' },
        description: { nl: 'Je kweekrapport 5 keer gedeeld.', en: 'Shared your grow report 5 times.', de: 'Deinen Grow-Report 5 Mal geteilt.', fr: 'Ton rapport de culture partagé 5 fois.', es: 'Tu informe de cultivo compartido 5 veces.' }
    },
    'CLOSE_TO_HARVEST': {
        title: { nl: 'Close to Harvest', en: 'Close to Harvest', de: 'Kurz vor der Ernte', fr: 'Proche de la Récolte', es: 'Cerca de la Cosecha' },
        description: { nl: 'Gedeeld via de "bijna oogst" popup.', en: 'Shared via the "close to harvest" popup.', de: 'Über die „Kurz-vor-der-Ernte“-Meldung geteilt.', fr: 'Partagé via la notification "proche de la récolte".', es: 'Compartido desde el aviso de "cerca de la cosecha".' }
    }
};


// === REFACTORED AFFILIATE LINK LOGIC ===

const AFFIL_ID = ""; // Add your affiliate ID here if you have one

// This object now only contains the language-independent parts of the URL (the "slug")
const RQS_PRODUCT_SLUGS = {
    heatMat: { slug: '322-starter-kit-feminized.html', type: 'growing' },
    growthNutrients: { slug: '355-easy-grow-booster-tablets.html', type: 'growing' },
    calMag: { slug: '568-easy-plus-micronutrients.html', type: 'growing' },
    fabricPots: { slug: '461-rqs-fabric-pot.html', type: 'growing' },
    ecMeter: { slug: '469-conductivity-tester.html', type: 'growing' },
    phMeter: { slug: '468-ph-tester.html', type: 'growing' },
    clipFan: { slug: '710-mars-hydro-100100180-grow-tent-kit.html', type: 'grow-tent-kits' },
    plantTies: { slug: '533-bending-clips.html', type: 'growing' },
    carbonFilter: { slug: '710-mars-hydro-100100180-grow-tent-kit.html', type: 'grow-tent-kits' },
    bloomNutrients: { slug: '356-easy-bloom-booster-tablet.html', type: 'growing' },
    pkBooster: { slug: '356-easy-bloom-booster-tablet.html', type: 'growing' },
    scrogNet: { slug: '534-scrog-netting.html', type: 'growing' },
    flushHarvestGuide: { slug: 'blog-top-tips-to-successfully-dry-and-cure-your-fresh-cannabis-buds-n682', type: 'blog' },
    flushingAgent: { slug: '42-let-s-get-started', type: 'content' },
    trimmingScissors: { slug: '467-curved-trimming-scissors.html', type: 'growing' },
    dryingRack: { slug: '550-rqs-herb-dryer.html', type: 'growing' },
    curingJars: { slug: '638-curing-vault.html', type: 'growing' },
    miniHygrometers: { slug: '710-mars-hydro-100100180-grow-tent-kit.html', type: 'grow-tent-kits' },
    humidityPacks: { slug: '519-humidity-control-pack.html', type: 'growing' },
};

// Refactored AANBEVOLEN_PRODUCTEN to use the new slug object
const AANBEVOLEN_PRODUCTEN = {
    seedling: [{ labelKey: 'heatMat' }],
    vegetative: [{ labelKey: 'growthNutrients' }, { labelKey: 'calMag' }, { labelKey: 'fabricPots' }, { labelKey: 'ecMeter' }, { labelKey: 'phMeter' }, { labelKey: 'clipFan' }, { labelKey: 'plantTies' }, { labelKey: 'carbonFilter' }],
    flowering: [{ labelKey: 'bloomNutrients' }, { labelKey: 'pkBooster' }, { labelKey: 'scrogNet' }, { labelKey: 'carbonFilter' }],
    flush: [{ labelKey: 'flushHarvestGuide' }, { labelKey: 'flushingAgent' }, { labelKey: 'trimmingScissors' }, { labelKey: 'dryingRack' }, { labelKey: 'curingJars' }, { labelKey: 'miniHygrometers' }, { labelKey: 'humidityPacks' }]
};

const RQS_SEED_SLUGS = { 'Onbekend/Algemeen': 'unknown-generic', 'Sticky Queen Auto': '714-sticky-queen-automatic.html', 'Mexican Rush Auto': '713-mexican-rush-automatic.html', 'Blue Cheese Auto': '312-blue-cheese-automatic.html', 'Royal Haze Auto': '131-royal-haze-automatic.html', 'Mimosa Auto': '537-mimosa-automatic.html', 'Royal Bluematic': '129-royal-bluematic.html', 'Royal Creamatic': '145-royal-creamatic.html', 'Green Gelato Auto': '489-green-gelato-automatic.html', 'Northern Light Auto': '125-northern-light-automatic.html', 'North Thunderfuck Auto': '570-north-thunderfuck-automatic.html', 'Triple G Auto': '572-triple-g-automatic.html', 'Haze Berry Auto': '362-haze-berry-automatic.html', 'Special Queen 1 Auto': '171-special-queen-1-automatic.html', 'Sweet ZZ Auto': '429-sweet-zz-automatic.html', 'Sweet Skunk Auto': '162-sweet-skunk-automatic.html', 'Cherry Pie Auto': '612-cherry-pie-automatic.html', 'Tropicana Cookies Purple Auto': '650-tropicana-cookies-purple-automatic.html', 'Trainwreck Auto': '513-trainwreck-automatic.html', 'Royal Cheese Auto': '171-royal-cheese-automatic.html', 'Granddaddy Purple Auto': '607-granddaddy-purple-automatic.html', 'Pink Runtz Auto': '639-pink-runtz-automatic.html', 'Grape Ape Auto': '608-grape-ape-automatic.html', 'White Widow Auto': '119-white-widow-automatic.html', 'NYC Sour D Auto': '665-nyc-sour-d-automatic.html', 'GOAT\'lato Auto': '666-goatlato-automatic.html', 'Corkscrew Auto': '712-corkscrew-automatic.html', 'Fat Banana Auto': '413-fat-banana-automatic.html', 'Cookies Gelato Auto': '507-cookies-gelato-automatic.html', 'Royal Runtz Auto': '575-royal-runtz-automatic.html', 'Royal Cookies Auto': '190-royal-cookies-automatic.html', 'Watermelon Auto': '544-watermelon-automatic.html', 'Apple Fritter Auto': '611-apple-fritter-automatic.html', 'Royal Critical Auto': '168-royal-critical-automatic.html', 'Sherbet Queen Auto': '478-sherbet-queen-automatic.html', 'HulkBerry Auto': '456-hulkberry-automatic.html', 'Purple Queen Auto': '482-purple-queen-automatic.html', 'Royal Gorilla Auto': '421-royal-gorilla-automatic.html', 'Wedding Cake Auto': '588-wedding-cake-automatic.html', 'Royal Dwarf': '130-royal-dwarf.html', 'Pink Mist Auto': '660-pink-mist-automatic.html', 'Easy Bud': '124-easy-bud.html', 'Purple Lemonade Auto': '648-purple-lemonade-automatic.html', 'Quick One': '126-quick-one.html', 'Diesel Auto': '180-diesel-automatic.html', 'Bubble Kush Auto': '315-bubble-kush-automatic.html', 'Amnesia Haze Auto': '165-amnesia-haze-automatic.html', 'Do-Si-Dos Auto': '585-do-si-dos-automatic.html', 'Royal Jack Auto': '179-royal-jack-automatic.html', 'Purple Punch Auto': '570-purple-punch-automatic.html', 'Royal Kush Auto': '171-royal-kush-automatic.html', 'Royal AK Auto': '154-royal-ak-automatic.html' };

// This single function now builds ALL RQS links correctly.
function buildRqsUrl(type, slug) {
    if (slug === 'unknown-generic') {
        return 'https://www.royalqueenseeds.com/34-autoflowering-cannabis-seeds';
    }
    if (!slug) return null;

    let domain = '';
    let paths = {};

    switch(currentLang) {
        case 'es':
            domain = 'https://www.royalqueenseeds.es';
            paths = {
                auto: '/semillas-autoflorecientes/',
                growing: '/guia-de-cultivo/',
                'grow-tent-kits': '/kits-de-cultivo-de-interior/',
                blog: '/blog/',
                content: '/content/'
            };
            break;
        case 'nl':
            domain = 'https://www.royalqueenseeds.nl';
            paths = {
                auto: '/autoflowering-cannabis-zaden/',
                growing: '/kweekgids/',
                'grow-tent-kits': '/kweektent-kits/',
                blog: '/blog/',
                content: '/content/'
            };
            break;
        case 'de':
            domain = 'https://www.royalqueenseeds.de';
            paths = {
                auto: '/autoflowering-hanfsamen/',
                growing: '/anbauanleitung/',
                'grow-tent-kits': '/growbox-komplettsets/',
                blog: '/blog/',
                content: '/content/'
            };
            break;
        case 'fr':
            domain = 'https://www.royalqueenseeds.fr';
            paths = {
                auto: '/graines-autofloraison/',
                growing: '/guide-de-culture/',
                'grow-tent-kits': '/kits-de-culture-interieur/',
                blog: '/blog/',
                content: '/content/'
            };
            break;
        default: // English (US) as default
            domain = 'https://www.royalqueenseeds.com';
            paths = {
                auto: '/us/autoflowering-cannabis-seeds/',
                growing: '/us/growing/',
                'grow-tent-kits': '/us/grow-tent-kits/',
                blog: '/us/blog/',
                content: '/us/content/'
            };
            break;
    }

    const path = paths[type] || '';
    return domain + path + slug;
}

function addAffil(url) {
    if (!url) return null;
    return AFFIL_ID ? url + (url.includes('?') ? '&' : '?') + AFFIL_ID : url;
}


/* ==== State & utils ==== */
let currentLang=localStorage.getItem('appLang')||'en';
let isDarkMode=localStorage.getItem('isDarkMode')==='true';
let inactivityTimer = null;
const uid=()=>Math.random().toString(36).slice(2,10);
const todayISO=()=>new Date().toISOString().slice(0,10);
const toISODate=d=>new Date(d).toISOString().slice(0,10);
const fmtDate=d=>new Date(d).toLocaleDateString(currentLang);
const fmtShortDate=d=>new Date(d).toLocaleDateString(currentLang,{day:'numeric',month:'short'});
const daysBetween=(a,b)=>Math.floor((new Date(b)-new Date(a))/86400000);
const weekNumberSince=(start,at)=>Math.floor(daysBetween(start,at)/7);
function t(k){return TRANSLATIONS[currentLang]?.[k]||TRANSLATIONS['en']?.[k]||`[${k}]`;}
/* ==== Strains (short) ==== */
const RQS_STRAINS = { 'Onbekend/Algemeen': { displayName: { nl: 'Onbekend/Algemeen', en: 'Unknown/Generic', de: 'Unbekannt/Allgemein', fr: 'Inconnu/Générique', es: 'Desconocido/Genérico' }, schedule: { waterEveryDays: 2, feedStartWeek: 2, feedEveryDays: 7, flushStartWeek: 9, targetHarvestWeek: 10 } }, 'Sticky Queen Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 11, targetHarvestWeek: 13 } }, 'Mexican Rush Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 12, targetHarvestWeek: 14 } }, 'Blue Cheese Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 9, targetHarvestWeek: 11 } }, 'Royal Haze Auto': { schedule: { waterEveryDays: 3, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 11, targetHarvestWeek: 13 } }, 'Mimosa Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 8, targetHarvestWeek: 10 } }, 'Royal Bluematic': { schedule: { waterEveryDays: 2, feedStartWeek: 2, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Royal Creamatic': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 11, targetHarvestWeek: 13 } }, 'Green Gelato Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 8, targetHarvestWeek: 10 } }, 'Northern Light Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'North Thunderfuck Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Triple G Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Haze Berry Auto': { schedule: { waterEveryDays: 3, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 8, targetHarvestWeek: 10 } }, 'Special Queen 1 Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Sweet ZZ Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 9, targetHarvestWeek: 11 } }, 'Sweet Skunk Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 2, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Cherry Pie Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 8, targetHarvestWeek: 10 } }, 'Tropicana Cookies Purple Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Trainwreck Auto': { schedule: { waterEveryDays: 3, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 11, targetHarvestWeek: 13 } }, 'Royal Cheese Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Granddaddy Purple Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Pink Runtz Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 9, targetHarvestWeek: 11 } }, 'Grape Ape Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 9, targetHarvestWeek: 11 } }, 'White Widow Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'NYC Sour D Auto': { schedule: { waterEveryDays: 3, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 11, targetHarvestWeek: 13 } }, 'GOAT\'lato Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 9, targetHarvestWeek: 11 } }, 'Corkscrew Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 11, targetHarvestWeek: 13 } }, 'Fat Banana Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 8, targetHarvestWeek: 10 } }, 'Cookies Gelato Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Royal Runtz Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 9, targetHarvestWeek: 11 } }, 'Royal Cookies Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Watermelon Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 7, targetHarvestWeek: 9 } }, 'Apple Fritter Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Royal Critical Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 9, targetHarvestWeek: 11 } }, 'Sherbet Queen Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 7, targetHarvestWeek: 9 } }, 'HulkBerry Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 7, targetHarvestWeek: 9 } }, 'Purple Queen Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 7, targetHarvestWeek: 9 } }, 'Royal Gorilla Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Wedding Cake Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 9, targetHarvestWeek: 11 } }, 'Royal Dwarf': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 8, targetHarvestWeek: 10 } }, 'Pink Mist Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 11, targetHarvestWeek: 13 } }, 'Easy Bud': { schedule: { waterEveryDays: 2, feedStartWeek: 2, feedEveryDays: 7, flushStartWeek: 8, targetHarvestWeek: 10 } }, 'Purple Lemonade Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Quick One': { schedule: { waterEveryDays: 2, feedStartWeek: 2, feedEveryDays: 7, flushStartWeek: 8, targetHarvestWeek: 10 } }, 'Diesel Auto': { schedule: { waterEveryDays: 3, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 12, targetHarvestWeek: 14 } }, 'Bubble Kush Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 9, targetHarvestWeek: 11 } }, 'Amnesia Haze Auto': { schedule: { waterEveryDays: 3, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Do-Si-Dos Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 8, targetHarvestWeek: 10 } }, 'Royal Jack Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Purple Punch Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 8, targetHarvestWeek: 10 } }, 'Royal Kush Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } }, 'Royal AK Auto': { schedule: { waterEveryDays: 2, feedStartWeek: 3, feedEveryDays: 7, flushStartWeek: 10, targetHarvestWeek: 12 } } };
const BESTSELLER_STRAINS = [ 'Northern Light Auto', 'Green Gelato Auto', 'White Widow Auto', 'Royal Haze Auto', 'Amnesia Haze Auto', 'Royal Gorilla Auto' ];
const getStrainDisplayName=key=>RQS_STRAINS[key]?.displayName?.[currentLang]||key;
/* ==== Storage ==== */
const LS_KEY='quickone_grow_tracker_v1_html';
let state={plants:[],viewArchived:false,unlockedBadges: [], shareCount: 0};
function logEvent(plantId, eventText) {
    const plant = getPlant(plantId);
    if (!plant) return;
    if (!plant.eventLog) {
        plant.eventLog = [];
    }
    plant.eventLog.unshift({
        timestamp: new Date().toISOString(),
        text: eventText
    });
}
function loadState(){
    try{
        const raw=localStorage.getItem(LS_KEY);
        const loadedState = raw ? JSON.parse(raw) : {};
        state = {
            plants: loadedState.plants || [],
            viewArchived: loadedState.viewArchived || false,
            unlockedBadges: loadedState.unlockedBadges || [],
            shareCount: loadedState.shareCount || 0
        };
        state.plants.forEach(p=>{
            p.acknowledgedActions=p.acknowledgedActions||[];
            if(typeof p.isCollapsed==='undefined')p.isCollapsed=false;
            if(typeof p.archived==='undefined')p.archived=false;
            if(typeof p.shareReminderShown === 'undefined') p.shareReminderShown = false;
            if(typeof p.noteUpdateCount === 'undefined') p.noteUpdateCount = 0;
            if(typeof p.dateChanged === 'undefined') p.dateChanged = false;
            if(typeof p.isSnoozed === 'undefined') p.isSnoozed = false;
            if(typeof p.eventLog === 'undefined') p.eventLog = [];
        });
    } catch(e) {
        state={plants:[],viewArchived:false,unlockedBadges: [], shareCount: 0};
    }
}
function saveState(){try{localStorage.setItem(LS_KEY,JSON.stringify(state));}catch(e){}}
loadState();
/* ==== Gamification Logic ==== */
function getGrowerRank(N){
    if (N >= 15) return 'The Cannabis King/Queen';
    if (N >= 10) return 'Ganja Grandmaster';
    if (N >= 7) return 'Master of Mary Jane';
    if (N >= 5) return 'Chronic Cultivator';
    if (N >= 3) return 'Top Talent';
    if (N >= 2) return 'Pot Apprentice';
    if (N >= 1) return 'Seedling Sitter';
    return 'Sprout Scout';
}
function showToast(message){const toast=document.getElementById('toast');if(!toast)return;toast.textContent=message;toast.classList.add('show');setTimeout(()=>{toast.classList.remove('show');},3500);}
function unlockBadge(badgeId) {
    if (!state.unlockedBadges.includes(badgeId)) {
        state.unlockedBadges.push(badgeId);
        const badge = BADGES[badgeId];
        const title = badge.title[currentLang] || badge.title['en'];
        showToast(`${t('toastNewAchievement')} ${title}`);
        saveState();
    }
}
function checkAllBadges(plant, eventType, data) {
    const completedCycles = state.plants.filter(p => p.archived);
    const N = completedCycles.length;

    // Badges checked on completing a cycle
    if (eventType === 'archive') {
        const uniqueStrains = new Set(completedCycles.map(p => p.strain));
        if (uniqueStrains.size >= 5) unlockBadge('TERP_TOURIST');
        if (uniqueStrains.size >= 10) unlockBadge('CATALOG_CONQUEROR');
        
        const quarters = new Set(completedCycles.map(p => Math.floor(new Date(p.planted_at).getMonth() / 3)));
        if (quarters.size >= 4) unlockBadge('SEASONAL_SAMPLER');
        
        if (!plant.dateChanged) unlockBadge('DRY_HANDS');

        const harvestAction = plant.acknowledgedActions.find(a => a.startsWith('harvest-'));
        if (harvestAction) {
            const harvestDate = new Date(harvestAction.split('-')[1]);
            const targetDate = new Date(plant.planted_at);
            targetDate.setDate(targetDate.getDate() + plant.schedule.targetHarvestWeek * 7);
            if (Math.abs(daysBetween(targetDate, harvestDate)) <= 1) {
                plant.onTimeHarvest = true;
            }
        }
        if (state.plants.filter(p => p.onTimeHarvest).length >= 3) unlockBadge('TIME_LORD');

        const photoWeeks = new Set(plant.photos.map(ph => weekNumberSince(plant.planted_at, ph.date)));
        let allWeeksCovered = true;
        for (let i = 0; i < plant.schedule.targetHarvestWeek; i++) {
            if (!photoWeeks.has(i)) {
                allWeeksCovered = false;
                break;
            }
        }
        if (allWeeksCovered && plant.schedule.targetHarvestWeek > 0) unlockBadge('WEEK_BY_WEEK');
    }

    // Badges checked on specific actions
    if (eventType === 'acknowledge') {
        if (data.actionId.startsWith('flush-')) {
            const flushDate = new Date(data.actionId.split('-')[1]);
            if (weekNumberSince(plant.planted_at, flushDate) === plant.schedule.flushStartWeek) {
                unlockBadge('ZEN_FLUSHER');
            }
        }
    }
    
    if (eventType === 'add_photo') {
        if (plant.photos.length >= 4) unlockBadge('SHUTTER_BUD');
    }

    if (eventType === 'update_notes') {
        if (plant.noteUpdateCount >= 4) unlockBadge('FIELD_NOTES');
    }

    if (eventType === 'share') {
        if (state.shareCount >= 1) unlockBadge('HYPE_MACHINE');
        if (state.shareCount >= 5) unlockBadge('COMMUNITY_CLOUD');
        if (data && data.source === 'harvest_prompt') {
            unlockBadge('CLOSE_TO_HARVEST');
        }
    }
}
function openStonerStatusModal(){
    const modal=document.getElementById('stonerStatusModal');
    const body=document.getElementById('stonerStatusBody');
    if(!modal||!body)return;
    const completedCycles=state.plants.filter(p=>p.archived);
    const N=completedCycles.length;
    const rank=getGrowerRank(N);
    const unlocked=state.unlockedBadges||[];
    const badgesHTML = Object.keys(BADGES).map(id => {
        const isUnlocked = unlocked.includes(id);
        const badge = BADGES[id];
        const title = badge.title[currentLang] || badge.title['en'];
        const description = badge.description[currentLang] || badge.description['en'];
        return `<li class="achievement-item ${isUnlocked ? 'unlocked' : 'locked'}">
            <span class="icon material-icons">${isUnlocked ? 'military_tech' : 'lock'}</span>
            <div class="details">
                <h4>${title}</h4>
                <p>${description}</p>
            </div>
        </li>`;
    }).join('');
    
    body.innerHTML=`<div style="text-align:center;margin-bottom:24px;padding:10px;background:var(--card);border-radius:12px;">
        <h3>${rank}</h3><p class="muted">${N} ${t('completedCycles')}</p>
    </div>
    <h4 class="section-title" style="margin-top:0;">${t('achievements')}</h4>
    <ul class="achievements-list">${badgesHTML}</ul>`;
    modal.style.display='flex';
}
/* ==== Actions ==== */
const createActionId=(type,date)=>`${type}-${toISODate(date)}`;
function getPendingActions(plant,dateToCheck){
    const out=[];const start=new Date(plant.planted_at);const today=dateToCheck;if(today<start)return[];
    const harvestDate=new Date(start);
    harvestDate.setDate(start.getDate()+plant.schedule.targetHarvestWeek*7);
    for(let d=new Date(start);d<=today;d.setDate(d.getDate()+1)){
        const age=daysBetween(start,d);const wk=Math.floor(age/7);const s=plant.schedule;const arr=[];
        const isBeforeHarvest=d<harvestDate;

        if (!plant.isSnoozed) {
            if(isBeforeHarvest&&age>0&&s.waterEveryDays>0&&age%s.waterEveryDays===0)arr.push({type:'water',label:t('water'),date:new Date(d)});
            if(isBeforeHarvest&&wk<s.flushStartWeek&&wk>=s.feedStartWeek){const startFeed=s.feedStartWeek*7;if(s.feedEveryDays>0&&(age-startFeed)>=0&&(age-startFeed)%s.feedEveryDays===0)arr.push({type:'feed',label:t('feed'),date:new Date(d)});};
            if(wk===s.flushStartWeek&&age===s.flushStartWeek*7)arr.push({type:'flush',label:t('startFlush'),date:new Date(d)});
        }
        
        if(age===s.targetHarvestWeek*7)arr.push({type:'harvest',label:t('harvest'),date:new Date(d)});
        
        arr.forEach(a=>{const id=createActionId(a.type,a.date);if(!plant.acknowledgedActions.includes(id))out.push(a);});
    }
    return out;
}
function showNudge() {
    if (state.plants.length === 0) {
        const nudgeEl = document.getElementById('nudge');
        if (nudgeEl) nudgeEl.style.display = 'block';
    }
}
/* ==== App init ==== */
document.addEventListener('DOMContentLoaded',()=>{
document.getElementById('langSelect').value=currentLang;
document.getElementById('langSelect').onchange=e=>{currentLang=e.target.value;localStorage.setItem('appLang',currentLang);translateUI();};
document.getElementById('darkModeToggle').onchange=e=>setDarkMode(e.target.checked);
const chk=document.getElementById('chkArchived');chk.checked=state.viewArchived;chk.onchange=e=>{state.viewArchived=e.target.checked;saveAndRender();};
document.getElementById('btnAdd').onclick=addPlant;document.getElementById('btnAdd2').onclick=addPlant;
document.getElementById('btnReset').onclick=()=>{if(confirm(t('confirmReset'))){localStorage.removeItem(LS_KEY);location.reload();}};
document.getElementById('btnHeaderShare').onclick=() => shareReportJPG();
document.getElementById('btnHelp').onclick=()=>document.getElementById('helpModal').style.display='flex';
document.getElementById('btnProfileDesktop').onclick=openStonerStatusModal;

document.getElementById('btnSaveHarvestReview').onclick = () => {
    if (!currentPlantIdForReview) return;
    const plant = getPlant(currentPlantIdForReview);
    const newNotes = document.getElementById('harvestReviewTextarea').value;

    if (plant && newNotes.trim() !== '') {
        const dateStr = new Date().toLocaleDateString(currentLang);
        const reviewHeader = `\n\n--- ${t('harvestReviewTitle')} (${dateStr}) ---\n`;
        const updatedNotes = (plant.notes || '') + reviewHeader + newNotes;
        updatePlant(currentPlantIdForReview, { notes: updatedNotes, archived: true });
    } else if (plant) {
        updatePlant(currentPlantIdForReview, { archived: true });
    }

    document.getElementById('harvestReviewModal').style.display = 'none';
    currentPlantIdForReview = null;
};

document.getElementById('btnSkipHarvestReview').onclick = () => {
    if (!currentPlantIdForReview) return;
    updatePlant(currentPlantIdForReview, { archived: true });
    document.getElementById('harvestReviewModal').style.display = 'none';
    currentPlantIdForReview = null;
};

// Modal closers
document.querySelectorAll('.modal-close,[data-close-modal]').forEach(b=>b.addEventListener('click',()=>{const m=b.closest('.modal-overlay');if(m)m.style.display='none';}));
document.querySelectorAll('.modal-overlay').forEach(ov=>ov.addEventListener('click',e=>{if(e.target===ov)ov.style.display='none';}));
setDarkMode(isDarkMode);translateUI();setupMenu();
const btnShareNow=document.getElementById('btnShareNow');
if(btnShareNow) btnShareNow.addEventListener('click', () => shareReportJPG());
const btnHarvestShareNow = document.getElementById('btnHarvestShareNow');
if (btnHarvestShareNow) btnHarvestShareNow.onclick = () => shareReportJPG({source: 'harvest_prompt'});
if (state.plants.length === 0) {
    inactivityTimer = setTimeout(showNudge, 25000);
}
});
function setupMenu(){const t=document.getElementById('btnMenuToggle'), m=document.getElementById('menuContent'); if(t&&m){t.onclick=e=>{e.stopPropagation();m.classList.toggle('is-open');}; document.addEventListener('click',e=>{if(m.classList.contains('is-open')&&!m.contains(e.target))m.classList.remove('is-open');});}}
function translateUI(){
const name=TRANSLATIONS[currentLang]?.appName||'Grow Buddy';
document.title=name;
const span=document.getElementById('appTitleText');
if(span) span.textContent=name;
document.getElementById('darkModeLabel').textContent=t('darkMode');
document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    const translation = t(key);
    // Ensure we don't overwrite child nodes like icons
    const textNode = Array.from(el.childNodes).find(node => node.nodeType === 3 && node.textContent.trim().length > 0); // Node.TEXT_NODE
    if (textNode) {
        textNode.textContent = translation;
    } else {
        const spanChild = el.querySelector('span:not([class])');
        if(spanChild) {
            spanChild.textContent = translation;
        } else if (el.childNodes.length === 0 || el.tagName === 'P' || el.tagName === 'H2' || el.tagName === 'LABEL' || el.tagName === 'BUTTON') {
            el.textContent = translation;
        }
    }
});
document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    el.placeholder = t(el.getAttribute('data-i18n-placeholder'));
});
document.getElementById('legal-content').innerHTML = t('termsAndPrivacyBody');
render();
}
function setDarkMode(enabled){isDarkMode=enabled;document.body.classList.toggle('dark',enabled);document.getElementById('darkModeToggle').checked=enabled;localStorage.setItem('isDarkMode',enabled);}
/* ==== Plant ops ==== */
function addPlant(){
if (inactivityTimer) {
    clearTimeout(inactivityTimer);
    inactivityTimer = null;
    const nudgeEl = document.getElementById('nudge');
    if (nudgeEl) nudgeEl.style.display = 'none';
}
const active=state.plants.filter(p=>!p.archived).length;if(active>=12){alert(t('alertMax'));return;}
const p={id:uid(),name:`${t('plant')} ${active+1}`,strain:'Onbekend/Algemeen',planted_at:todayISO(),notes:"",photos:[],acknowledgedActions:[],isCollapsed:false,archived:false, shareReminderShown: false, noteUpdateCount: 0, dateChanged: false, isSnoozed: false, eventLog: [], schedule:{...RQS_STRAINS['Onbekend/Algemeen'].schedule}};
state.plants.unshift(p);
logEvent(p.id, t('logPlantCreated'));
saveAndRender();
}
function getPlant(id){return state.plants.find(p=>p.id===id);}
function updatePlant(id,props){
    const p=getPlant(id);
    if(p){
        if (props.notes !== undefined && props.notes !== p.notes) {
            p.noteUpdateCount = (p.noteUpdateCount || 0) + 1;
            logEvent(id, t('logNoteUpdated'));
            checkAllBadges(p, 'update_notes');
        }
        if (props.planted_at !== undefined && p.planted_at !== props.planted_at) {
            p.dateChanged = true;
            logEvent(id, `${t('logDateChanged')} ${fmtDate(props.planted_at)}`);
        }
        if (props.archived !== undefined && p.archived !== props.archived) {
            logEvent(id, props.archived ? t('logCycleCompleted') : t('logCycleRestored'));
        }

        Object.assign(p,props);
        if (props.archived === true) {
            checkAllBadges(p, 'archive');
        }
        saveAndRender();
    }
}
function deletePlant(id){if(confirm(t('alertDelete'))){state.plants=state.plants.filter(p=>p.id!==id);saveAndRender();}}
function toggleCollapse(id){const p=getPlant(id);if(p){p.isCollapsed=!p.isCollapsed;saveAndRender();}}
function toggleSnooze(id, isSnoozed) { 
    logEvent(id, isSnoozed ? t('logSnoozeEnabled') : t('logSnoozeDisabled'));
    updatePlant(id, { isSnoozed }); 
}
window.toggleSnooze=toggleSnooze;
function initiateArchiveProcess(id) {
    currentPlantIdForReview = id;
    const modal = document.getElementById('harvestReviewModal');
    document.getElementById('harvestReviewTextarea').value = '';
    modal.style.display = 'flex';
}
window.initiateArchiveProcess = initiateArchiveProcess;

function handleStrainChange(id,key){
    logEvent(id, `${t('logStrainChanged')} ${getStrainDisplayName(key)}`);
    const s=RQS_STRAINS[key]?.schedule||RQS_STRAINS['Onbekend/Algemeen'].schedule;
    updatePlant(id,{strain:key,schedule:{...s}});
}
function openHarvestShareModal() {
    const modal = document.getElementById('harvestShareModal');
    if (!modal) return;
    document.getElementById('harvestShareText').textContent = t('harvestSharePrompt');
    modal.style.display = 'flex';
}
function saveAndRender(){
const plantsToRemind = [];
state.plants.forEach(p => {
    if (!p.archived && !p.shareReminderShown) {
        const harvestDate = new Date(p.planted_at);
        harvestDate.setDate(harvestDate.getDate() + p.schedule.targetHarvestWeek * 7);
        const daysUntilHarvest = daysBetween(new Date(), harvestDate);
        if (daysUntilHarvest <= 7 && daysUntilHarvest >= 0) {
            plantsToRemind.push(p);
        }
    }
});
if (plantsToRemind.length > 0) {
    openHarvestShareModal();
    plantsToRemind.forEach(p => {
        p.shareReminderShown = true;
    });
}
saveState();
render();
}
window.addPlant=addPlant;window.updatePlant=updatePlant;window.deletePlant=deletePlant;window.toggleCollapse=toggleCollapse;window.handleStrainChange=handleStrainChange;
/* ==== Phases ==== */
function getPhaseForDate(plant,iso){const w=weekNumberSince(plant.planted_at, new Date(iso));
if(w<2)return'seedling';
if(w<4)return'vegetative';
const fsw=plant.schedule.flushStartWeek||8;
if(w<fsw)return'flowering';
return'flush';}
/* ==== Progress ==== */
function createProgressBarHTML(plant){
const s=plant.schedule,totalW=Math.max(1,s.targetHarvestWeek);
const seedW=Math.min(2,totalW),vegW=Math.max(0,Math.min(4,totalW)-seedW),flowW=Math.max(0,Math.min(s.flushStartWeek,totalW)-(seedW+vegW)),flushW=Math.max(0,totalW-(seedW+vegW+flowW));
const pct=w=>(w/totalW)*100;
const start=new Date(plant.planted_at),end=new Date(start);end.setDate(end.getDate()+s.targetHarvestWeek*7);
const elapsedDays=Math.max(0,daysBetween(start,new Date()));const progressPct=Math.max(0,Math.min(100,(elapsedDays/(s.targetHarvestWeek*7))*100));
return `<div class="progress-wrapper">
<div class="progress-date-labels"><span>${fmtDate(start)}</span><span>${fmtDate(end)}</span></div>
<div class="progress-bar-container">
<div class="progress-bar">
<div class="progress-segment seg-seed" style="width:${pct(seedW)}%"></div>
<div class="progress-segment seg-veg" style="width:${pct(vegW)}%"></div>
<div class="progress-segment seg-flow" style="width:${pct(flowW)}%"></div>
<div class="progress-segment seg-flush"style="width:${pct(flushW)}%"></div>
</div>
<div class="progress-marker" style="left:${progressPct}%"></div>
<div class="progress-marker-label" style="left:${progressPct}%">${t('today')}</div>
</div>
<div class="progress-phase-labels-container">
<div class="progress-phase-label" style="width:${pct(seedW)}%">${t('seedling')}</div>
<div class="progress-phase-label" style="width:${pct(vegW)}%">${t('vegetative')}</div>
<div class="progress-phase-label" style="width:${pct(flowW)}%">${t('flowering')}</div>
<div class="progress-phase-label" style="width:${pct(flushW)}%">${t('flush')}</div>
</div>
</div>`;
}
/* ==== Recommended Gear Component ==== */
function createRecommendedGearHTML(phase,titlePrefix){const products=AANBEVOLEN_PRODUCTEN[phase];if(!products||products.length===0){return'';}
const titleKey=`${titlePrefix}${phase.charAt(0).toUpperCase()+phase.slice(1)}`;const titleHTML=`<div class="section-title">${t(titleKey)}</div>`;
const buttonsHTML=products.map(p=>{
    const productInfo = RQS_PRODUCT_SLUGS[p.labelKey];
    if (!productInfo) return '';
    const url = addAffil(buildRqsUrl(productInfo.type, productInfo.slug));
    const label=t(p.labelKey);
    return`<a href="${url}" target="_blank" rel="noopener nofollow" class="btn btn-affiliate">${label}</a>`;
}).join('');
return`<div style="margin-top:16px;">${titleHTML}<div style="display:flex; flex-wrap:wrap; gap:8px; margin-top:8px;">${buttonsHTML}</div></div>`;}
/* ==== Reminder info popup ==== */
function showReminderInfo(plantId,actionType,iso){
    const plant=getPlant(plantId);
    const phase=getPhaseForDate(plant,iso);
    const copy=REMINDER_COPY[currentLang]||REMINDER_COPY['en'];
    let html='';
    if(actionType==='feed'){html=(copy.feed&&copy.feed[phase])||'';}
    else if(actionType==='water'){html=(copy.water&&copy.water[phase])||'';}
    else if(actionType==='flush'){html=copy.flush||'';}
    else if(actionType==='harvest'){html=copy.harvest||'';}

    // Use 'flush' gear for harvest and flush info, otherwise use the current phase's gear
    const gearPhase = (actionType === 'harvest' || actionType === 'flush') ? 'flush' : phase;
    const recommendedGearHTML = createRecommendedGearHTML(gearPhase,'essentialTools');
    
    if(recommendedGearHTML){html+=`<hr style="border:0; border-top:1px solid var(--line); margin: 16px 0;">`+recommendedGearHTML;}
    document.getElementById('infoBody').innerHTML=html||'<p>—</p>';
    document.getElementById('helpModal2').style.display='flex';
}
window.showReminderInfo=showReminderInfo;
/* ==== Render ==== */
function renderHeaderStatus(){const display=document.getElementById('growerStatusDisplay');if(!display)return;const N=state.plants.filter(p=>p.archived).length;const rank=getGrowerRank(N);const label=t('completedHarvestsLabel');display.innerHTML=`${rank} | 🪴 ${N} ${label}`;}
function render(){
const active=state.plants.filter(p=>!p.archived), archived=state.plants.filter(p=>p.archived);
const grid=document.getElementById('grid'), archivedGrid=document.getElementById('archivedGrid'), archivedSection=document.getElementById('archivedSection');
grid.innerHTML=active.map(p=>{
const ageDays=Math.max(0,daysBetween(p.planted_at,new Date())), w=Math.floor(ageDays/7), d=ageDays%7;
const seedUrl = addAffil(buildRqsUrl('auto', RQS_SEED_SLUGS[p.strain]));
const buyBtn=seedUrl? `<a class="btn-affiliate" href="${seedUrl}" target="_blank" rel="noopener nofollow">${t('buyNow')}</a>`:'';
const allStrains = Object.keys(RQS_STRAINS);
const otherStrains = allStrains.filter(s => !BESTSELLER_STRAINS.includes(s) && s !== 'Onbekend/Algemeen');
const sortedStrains = ['Onbekend/Algemeen', ...BESTSELLER_STRAINS, ...otherStrains];
const strainOptions = sortedStrains.map(s=>`<option value="${s}" ${p.strain===s?'selected':''}>${getStrainDisplayName(s)}</option>`).join('');
return `<div class="card ${p.isCollapsed?'is-collapsed':''}" id="card_${p.id}">
<div class="card-h">
<div class="row-name">
<input type="text" value="${p.name}" onchange="updatePlant('${p.id}',{name:this.value})"/>
<button class="btn-collapse btn-icon" onclick="toggleCollapse('${p.id}')"><svg fill="currentColor" viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg></button>
</div>
<div class="row-strain">
<select onchange="handleStrainChange('${p.id}',this.value)">${strainOptions}</select>
${buyBtn}
</div>
<div class="row-info">
<label><span class="muted">${t('planted')}</span> <input type="date" value="${p.planted_at}" onchange="updatePlant('${p.id}',{planted_at:this.value})"/></label>
<span class="pill"><b>${t('age')}</b> ${w} ${t('weeks')} ${d} ${t('days')}</span>
<div class="action-buttons">
<button onclick="initiateArchiveProcess('${p.id}')">${t('archivedCycle')}</button>
<button class="danger" onclick="deletePlant('${p.id}')">${t('delete')}</button>
</div>
</div>
${renderActionsBar(p)}
${createProgressBarHTML(p)}
</div>
<div class="card-b">
<div class="tabs">
<button class="tab active" data-tab="timeline" onclick="switchTab(this,'${p.id}')">${t('timeline')}</button>
<button class="tab" data-tab="reminders" onclick="switchTab(this,'${p.id}')">${t('reminders')}</button>
<button class="tab" data-tab="notes" onclick="switchTab(this,'${p.id}')">${t('notes')}</button>
<button class="tab" data-tab="eventlog" onclick="switchTab(this,'${p.id}')">${t('eventLog')}</button>
</div>
<div id="content_${p.id}" style="margin-top:12px;"></div>
</div>
</div>`;
}).join('');
archivedGrid.innerHTML=archived.map(p=>`<div class="card"><div class="card-h"><div class="row-name"><b>${p.name}</b> <span class="muted" style="margin-left:8px">(${getStrainDisplayName(p.strain)})</span></div><div class="row-info"><span>${t('planted')} ${fmtDate(p.planted_at)}</span><div class="action-buttons"><button onclick="updatePlant('${p.id}',{archived:false})">${t('unarchive')}</button><button class="danger" onclick="deletePlant('${p.id}')">${t('delete')}</button></div></div></div></div>`).join('');
document.getElementById('empty').style.display=state.plants.length===0?'block':'none';
grid.style.display=state.plants.length>0?'grid':'none';
archivedSection.style.display=state.viewArchived&&archived.length>0?'block':'none';
active.forEach(p=>{const card=document.getElementById(`card_${p.id}`);if(card&&!p.isCollapsed){const tab=card.querySelector('.tab.active');if(tab)switchTab(tab,p.id);}});
renderHeaderStatus();
}
function renderActionsBar(plant,overrideDate=null){
const actions=getPendingActions(plant,overrideDate||new Date());
if(actions.length===0)return `<div class="actions-bar" id="actions_${plant.id}"></div>`;
const html=actions.map(a=>{const id=createActionId(a.type,a.date);const iso=toISODate(a.date);return `<div class="action-item ${a.type}" onclick="acknowledgeAction('${plant.id}','${id}')"><div class="left"><span>${a.label}</span><button type="button" class="btn-icon" style="width:24px;height:24px;margin-left:4px;" onclick="event.stopPropagation();showReminderInfo('${plant.id}','${a.type}','${iso}')">?</button></div><span class="action-date">${fmtShortDate(a.date)}</span></div>`;}).join('');
return `<div class="actions-bar" id="actions_${plant.id}">${html}</div>`;
}
window.render=render;
/* ==== Tabs ==== */
function switchTab(el,id){
const card=el.closest('.card');card.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');
const tab=el.getAttribute('data-tab');const c=document.getElementById(`content_${id}`);const p=getPlant(id);
if(tab==='timeline')c.innerHTML=renderTimeline(p);
if(tab==='reminders')c.innerHTML=renderReminders(p);
if(tab==='notes')c.innerHTML=renderNotes(p);
if(tab==='eventlog')c.innerHTML=renderEventLog(p);
}
window.switchTab=switchTab;
function renderTimeline(p){
const byWeek=p.photos.reduce((acc,x)=>{const w=weekNumberSince(p.planted_at,x.date);(acc[w]||(acc[w]=[])).push(x);return acc;}, {});
return `<div class="uploader">
<label>${t('date')}</label><input type="date" id="photo_date_${p.id}" value="${todayISO()}"/>
<label>${t('noteOptional')}</label><input type="text" id="photo_note_${p.id}" placeholder="W${weekNumberSince(p.planted_at,todayISO())}"/>
<input type="file" id="photo_file_${p.id}" accept="image/*"/><button onclick="addPhoto('${p.id}')">${t('uploadPhoto')}</button>
</div>
<div style="margin-top:16px;">
${Object.keys(byWeek).sort((a,b)=>a-b).map(w=>
`<div class="section-title" style="margin-top:0;">Week ${w}</div>
<div class="grid" style="gap:12px;margin-bottom:12px;">
${byWeek[w].map(ph=>
`<figure>
<img src="${ph.data}" alt="Week ${w}"/>
<figcaption>
<div><div class="muted">${fmtDate(ph.date)}</div><div>${ph.note||''}</div></div>
<button class="danger" style="padding:4px 8px;font-size:12px" onclick="removePhoto('${p.id}','${ph.id}')">${t('remove')}</button>
</figcaption>
</figure>`
).join('')}
</div>`).join('') || `<p class="muted" style="text-align:center;">${t('noPhotos')}</p>`}
</div>`;
}

function renderEventLog(p) {
    if (!p.eventLog || p.eventLog.length === 0) {
        return `<p class="muted" style="text-align:center;">Nog geen gebeurtenissen gelogd.</p>`;
    }
    const logHTML = p.eventLog.map(event => {
        const timestamp = new Date(event.timestamp).toLocaleString(currentLang, {
            day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit'
        });
        return `<div class="event-item">
            <span class="event-timestamp">${timestamp}</span>
            <span class="event-text">${event.text}</span>
        </div>`;
    }).join('');
    return `<div class="event-log-container">${logHTML}</div>`;
}

function renderReminders(p){
const s=p.schedule;const phase=getPhaseForDate(p,todayISO());
const nutrInfo = RQS_PRODUCT_SLUGS['growthNutrients'];
const nutrUrl = addAffil(buildRqsUrl(nutrInfo.type, nutrInfo.slug));
const buyBtn=nutrUrl?`<a class="btn-affiliate" href="${nutrUrl}" target="_blank" rel="noopener nofollow">${t('buyNow')}</a>`:'';
const settingsHTML=`<div class="reminder-grid">
    <div class="reminder-label" style="font-weight: bold;">
        <span>${t('snoozeReminders')}</span>
    </div>
    <div class="reminder-controls">
        <label class="toggle-switch">
            <input type="checkbox" ${p.isSnoozed ? 'checked' : ''} onchange="toggleSnooze('${p.id}', this.checked)" />
            <span class="slider"></span>
        </label>
    </div>
</div>
<hr style="border:0; border-top: 1px dashed var(--line); margin: 16px 0;">
<div class="reminder-grid">
  <div class="reminder-label">
    <span>${t('water')}</span>
    <button type="button" class="btn-icon" style="width:24px;height:24px;" title="?" onclick="showReminderInfo('${p.id}','water','${todayISO()}')">?</button>
  </div>
  <div class="reminder-controls">
    <span>${t('every')}</span>
    <input type="number" value="${s.waterEveryDays}" min="1" onchange="updateSchedule('${p.id}','waterEveryDays',this.value)" ${p.isSnoozed ? 'disabled' : ''}/>
    <span>${t('daysPlural')}</span>
  </div>

  <div class="reminder-label">
    <span>${t('feed')}</span>
    <button type="button" class="btn-icon" style="width:24px;height:24px;" title="?" onclick="showReminderInfo('${p.id}','feed','${todayISO()}')">?</button>
  </div>
  <div class="reminder-controls">
    <span>${t('startInWeek')}</span>
    <input type="number" value="${s.feedStartWeek}" min="0" onchange="updateSchedule('${p.id}','feedStartWeek',this.value)" ${p.isSnoozed ? 'disabled' : ''}/>
    <span style="border-left: 1px solid var(--line); height: 16px; margin: 0 4px;"></span>
    <span>${t('frequency')}</span>
    <input type="number" value="${s.feedEveryDays}" min="1" onchange="updateSchedule('${p.id}','feedEveryDays',this.value)" ${p.isSnoozed ? 'disabled' : ''}/>
    <span>${t('daysPlural')}</span>
  </div>

  <div class="reminder-label">
    <span>${t('startFlush')}</span>
    <button type="button" class="btn-icon" style="width:24px;height:24px;" title="?" onclick="showReminderInfo('${p.id}','flush','${todayISO()}')">?</button>
  </div>
  <div class="reminder-controls">
    <span>${t('flushStartWeek')}</span>
    <input type="number" value="${s.flushStartWeek}" min="1" onchange="updateSchedule('${p.id}','flushStartWeek',this.value)" ${p.isSnoozed ? 'disabled' : ''}/>
  </div>
 
  <div class="reminder-label">
    <span>${t('targetHarvestWeek')}</span>
    <button type="button" class="btn-icon" style="width:24px;height:24px;" title="?" onclick="showReminderInfo('${p.id}','harvest','${todayISO()}')">?</button>
  </div>
  <div class="reminder-controls">
    <input type="number" value="${s.targetHarvestWeek}" min="1" onchange="updateSchedule('${p.id}','targetHarvestWeek',this.value)"/>
  </div>

  <div class="hint" style="margin-top:8px; grid-column: 1 / -1; border-top: 1px dashed var(--line); padding-top: 12px;">
    <b>${t('strainGuideline')}</b> — ${getStrainDisplayName(p.strain)}<br/>${t('adjustNote')}
  </div>
</div>`;
let recommendedGearHTML = createRecommendedGearHTML(phase, 'recommendedFor');
if (phase === 'seedling') {
    recommendedGearHTML += createRecommendedGearHTML('vegetative', 'recommendedFor');
} else if (phase === 'vegetative') {
    recommendedGearHTML += createRecommendedGearHTML('flowering', 'recommendedFor');
} else if (phase === 'flowering') {
    recommendedGearHTML += createRecommendedGearHTML('flush', 'recommendedFor');
}
const footerContent = `<div style="display:flex; justify-content:space-between; align-items:flex-start; flex-wrap:wrap; gap:10px;">
    ${recommendedGearHTML}
    <div style="margin-top:24px; flex-shrink:0;">${buyBtn}</div>
</div>`;
return settingsHTML + `<div class="sticky-footer-container">${footerContent}</div>`;
}

function renderNotes(p){return `<textarea style="width:100%;min-height:120px;" onblur="updatePlant('${p.id}',{notes:this.value})" placeholder="${t('notesPlaceholder')}">${p.notes||''}</textarea>`;}
function updateSchedule(id,key,val){
    const p=getPlant(id);
    logEvent(id, `Schedule updated: '${key}' set to '${val}'`);
    p.schedule[key]=parseInt(val,10);
    saveAndRender();
}
window.updateSchedule=updateSchedule;
function addPhoto(id){
const fi=document.getElementById(`photo_file_${id}`),date=document.getElementById(`photo_date_${id}`).value,note=document.getElementById(`photo_note_${id}`).value;
if(!fi.files[0]){alert(t('alertPhoto'));return;}
const r=new FileReader();r.onload=e=>{
    const p=getPlant(id);
    p.photos.push({id:uid(),date,note,data:e.target.result});
    p.photos.sort((a,b)=>new Date(a.date)-new Date(b.date));
    logEvent(id, t('logPhotoAdded'));
    checkAllBadges(p, 'add_photo');
    saveAndRender();
};
r.readAsDataURL(fi.files[0]);
}
window.addPhoto=addPhoto;
function removePhoto(id,photoId){const p=getPlant(id);p.photos=p.photos.filter(x=>x.id!==photoId);saveAndRender();}
window.removePhoto=removePhoto;
function acknowledgeAction(id,actId){
    const p=getPlant(id);
    if(p&&!p.acknowledgedActions.includes(actId)){
        p.acknowledgedActions.push(actId);
        checkAllBadges(p, 'acknowledge', { actionId: actId });
        saveAndRender();
    }
}
window.acknowledgeAction=acknowledgeAction;
/* ==== Share modal ==== */
function openShareModal(){document.getElementById('shareModal').style.display='flex';document.getElementById('shareFallbackMsg').style.display=navigator.share?'none':'block';}
window.openShareModal=openShareModal;
/* ===== Rapport bouwen als Blob (JPEG) ===== */
async function buildReportJPGBlob() {
const active = state.plants.filter(p => !p.archived);
const W = 1080, headerH = 260, rowH = 320, VPad = 32, HPad = 40;
const H = headerH + (active.length * (rowH + VPad)) + VPad;
const canvas = document.createElement('canvas');
canvas.width = W;
canvas.height = Math.max(headerH + VPad * 2, H);
const ctx = canvas.getContext('2d');
// Light mode kleuren
const C = { bg:'#FFFFFF', fg:'#2c3e50', main:'#38761D', muted:'#5a7b8c', line:'#cce7ff', segSeed:'#f7d794', segVeg:'#77dd77', segFlow:'#fdfd96', segFlush:'#89cff0', danger:'#e74c3c' };
ctx.fillStyle = C.bg;
ctx.fillRect(0,0,canvas.width,canvas.height);
const appName = TRANSLATIONS[currentLang]?.appName || 'Grow Buddy';
const intro = REPORT_INTRO[currentLang] || REPORT_INTRO['en'];
const dateStr = new Date().toLocaleString(currentLang, { year:'numeric', month:'long', day:'numeric' });
// Logo
const logo = await new Promise(res => {
const img = new Image();
img.crossOrigin = 'anonymous';
img.onload = () => res(img);
img.onerror = () => res(null);
img.src = 'kweekmaatjelogo.png';
});
// Header
let tx = HPad;
if (logo) {
ctx.drawImage(logo, HPad, 24, 56, 56);
tx = HPad + 56 + 12;
}
ctx.fillStyle = C.main;
ctx.font = 'bold 44px Nunito, system-ui, Arial';
ctx.fillText(appName, tx, 70);
ctx.fillStyle = C.fg;
ctx.font = '28px Nunito, system-ui, Arial';
ctx.fillText(intro, HPad, 120);
ctx.fillStyle = C.muted;
ctx.font = '20px Nunito, system-ui, Arial';
ctx.fillText(`${t('growthReportTitle')} • ${dateStr}`, HPad, 160);
ctx.strokeStyle = C.line;
ctx.lineWidth = 2;
ctx.beginPath();
ctx.moveTo(HPad, 190);
ctx.lineTo(W - HPad, 190);
ctx.stroke();
function drawPB(x,y,w,h,plant){
const s=plant.schedule,totalW=Math.max(1,s.targetHarvestWeek);
const seedW=Math.min(2,totalW), vegW=Math.max(0,Math.min(4,totalW)-seedW), flowW=Math.max(0,Math.min(s.flushStartWeek,totalW)-(seedW+vegW)), flushW=Math.max(0,totalW-(seedW+vegW+flowW));
const px = p => Math.round((p/totalW)*w);
ctx.strokeStyle=C.line;
ctx.lineWidth=2;
ctx.strokeRect(x,y,w,h);
let cur=x;
const segs=[{w:px(seedW),c:C.segSeed},{w:px(vegW),c:C.segVeg},{w:px(flowW),c:C.segFlow},{w:px(flushW),c:C.segFlush}];
segs.forEach(sg=>{
if(sg.w>0){
ctx.fillStyle=sg.c;
ctx.fillRect(cur,y,sg.w,h);
cur+=sg.w;
}});
const elapsed=Math.max(0,daysBetween(plant.planted_at,new Date()));
const prog=Math.max(0,Math.min(1,elapsed/(s.targetHarvestWeek*7)));
const mx=x+Math.round(w*prog);
ctx.fillStyle=C.danger;
ctx.fillRect(mx-1,y-6,3,h+12);
ctx.fillStyle=C.danger;
ctx.font='bold 12px Nunito, system-ui, Arial';
const lab=t('today');
const tw=ctx.measureText(lab).width+8;
const lx=Math.min(W-HPad-tw,Math.max(HPad,mx-tw/2));
ctx.fillRect(lx,y-26,tw,18);
ctx.fillStyle='#fff';
ctx.fillText(lab,lx+4,y-12);
ctx.fillStyle=C.muted;
ctx.font='12px Nunito, system-ui, Arial';
const st=new Date(plant.planted_at), en=new Date(st); en.setDate(en.getDate()+s.targetHarvestWeek*7);
ctx.fillText(fmtDate(st),x,y+h+16);
const enTxt=fmtDate(en);
const ew=ctx.measureText(enTxt).width;
ctx.fillText(enTxt,x+w-ew,y+h+16);
}
async function drawLatest(x,y,w,h,plant){
const arr=(plant.photos||[]).slice().sort((a,b)=>new Date(a.date)-new Date(b.date));
const last=arr[arr.length-1];
ctx.strokeStyle=C.line;
ctx.lineWidth=2;
ctx.strokeRect(x,y,w,h);
if(!last){
ctx.fillStyle='#fafafa';
ctx.fillRect(x+2,y+2,w-4,h-4);
ctx.fillStyle=C.muted;
ctx.font='16px Nunito, system-ui, Arial';
const txt=t('noPhotos');
const tw=ctx.measureText(txt).width;
ctx.fillText(txt, x+(w-tw)/2, y+h/2);
return;
}
await new Promise(r=>{
const img=new Image();
img.onload=()=>{
const ir=img.width/img.height, br=w/h;
let dw,dh,dx,dy;
if(ir>br){ dh=h; dw=ir*dh; dx=x+(w-dw)/2; dy=y; }
else { dw=w; dh=dw/ir; dx=x; dy=y+(h-dh)/2; }
ctx.drawImage(img,dx,dy,dw,dh);
r();
};
img.onerror=()=>r();
img.src=last.data;
});
}
// Rows
let y = 220;
for (const p of active) {
ctx.fillStyle=C.fg;
ctx.font='bold 26px Nunito, system-ui, Arial';
ctx.fillText(p.name, 40, y);
ctx.fillStyle=C.muted;
ctx.font='18px Nunito, system-ui, Arial';
ctx.fillText(getStrainDisplayName(p.strain), 40, y+26);
drawPB(40, y+44, W-40*2-360, 18, p);
/* eslint-disable no-await-in-loop */
await drawLatest(W-40-320, y-10, 320, 180, p);
/* eslint-enable no-await-in-loop */
ctx.strokeStyle='#eee';
ctx.lineWidth=1;
ctx.beginPath();
ctx.moveTo(40,y+rowH-8);
ctx.lineTo(W-40,y+rowH-8);
ctx.stroke();
y += rowH;
}
// DataURL → Blob
const dataURL = canvas.toDataURL('image/jpeg', 0.92);
const arr = dataURL.split(','), mime = arr[0].match(/:(.*?);/)[1], bstr = atob(arr[1]);
let n = bstr.length;
const u8arr = new Uint8Array(n);
while(n--) u8arr[n] = bstr.charCodeAt(n);
return new Blob([u8arr], { type: mime });
}
/* ===== Delen: popup-knop fix ===== */
async function shareReportJPG(options = {}) {
state.shareCount = (state.shareCount || 0) + 1;
checkAllBadges(null, 'share', options);
saveState();

const title = TRANSLATIONS[currentLang]?.appName || 'Grow Buddy';
const text = REPORT_INTRO[currentLang] || REPORT_INTRO['en'];
const supportsFileShare = !!(navigator.canShare && typeof File !== 'undefined');
// Desktop/Pages: direct tekst delen (gesture blijft leven), dan JPG renderen + downloaden
if (navigator.share && !supportsFileShare) {
try {
await navigator.share({ title, text });
} catch(_) { /* user canceled: ok */ }
try {
const blob = await buildReportJPGBlob();
const name = title.replace(/\s+/g,'_') + '_report.jpg';
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = name;
document.body.appendChild(a);
a.click();
a.remove();
URL.revokeObjectURL(url);
} finally {
document.getElementById('shareModal').style.display = 'none';
}
return;
}
// Mobiel / Level 2: eerst JPG bouwen en als file delen
try {
const blob = await buildReportJPGBlob();
const name = title.replace(/\s+/g,'_') + '_report.jpg';
if (supportsFileShare) {
const file = new File([blob], name, { type: 'image/jpeg' });
if (navigator.canShare({ files: [file] })) {
await navigator.share({ files: [file], title, text });
} else if (navigator.share) {
await navigator.share({ title, text });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = name;
document.body.appendChild(a);
a.click();
a.remove();
URL.revokeObjectURL(url);
} else {
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = name;
document.body.appendChild(a);
a.click();
a.remove();
URL.revokeObjectURL(url);
}
}
} catch (err) {
// Fallback: download
try {
const blob = await buildReportJPGBlob();
const name = title.replace(/\s+/g,'_') + '_report.jpg';
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = name;
document.body.appendChild(a);
a.click();
a.remove();
URL.revokeObjectURL(url);
} finally {
document.getElementById('shareModal').style.display = 'none';
}
return;
}
// Sluit alle deel-popups na de actie
document.getElementById('shareModal').style.display = 'none';
document.getElementById('harvestShareModal').style.display = 'none';
}
window.shareReportJPG=shareReportJPG;
</script>
</body>
</html>
